<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="inquiry" >

	<insert id="insertInquiry" parameterType="InquiryVO" useGeneratedKeys="true" keyProperty="inquiry_id">
		INSERT INTO TB_INQUIRY (
		  	inquiry_title
		  , inquiry_contents
		  , user_id
		  , user_name
		  , inquiry_file_url
		  , inquiry_type
		  , academy_id
		  , updt_date
		  , regi_date
		) VALUES (
		   #{inquiry_title}
		  , #{inquiry_contents}
		  , #{user_id}
		  , #{user_name}
		  , #{inquiry_file_url}
		  , #{inquiry_type}
		  , #{academy_id}
		  , NOW()
		  , NOW()
		)
	</insert>
	
	<update id="updateInquiry" parameterType="InquiryVO">
		UPDATE TB_INQUIRY
		   SET inquiry_title = #{inquiry_title}
		   	 , inquiry_contents = #{inquiry_contents}
		   	 , inquiry_file_url = #{inquiry_file_url}
		   	 , inquiry_type = #{inquiry_type}
		     , updt_date = NOW()
		 WHERE inquiry_id = #{inquiry_id}
	</update>
	
	<update id="updateInquiryAnswer" parameterType="InquiryVO">
		UPDATE TB_INQUIRY
		   SET inquiry_answer = #{inquiry_answer}
		   	 , inquiry_answer_file_url = #{inquiry_answer_file_url}
		   	 , answer_id = #{answer_id}
		   	 , answer_name = #{answer_name}
		     , updt_date = NOW()
		 WHERE inquiry_id = #{inquiry_id}
	</update>
	
	<delete id="deleteInquiry" parameterType="InquiryVO">
		<![CDATA[
		DELETE FROM TB_INQUIRY
		 WHERE inquiry_id = #{inquiry_id}
		]]>
	</delete>
	
	<select id="selectInquiryList" parameterType="SearchVO" resultType="InquiryVO">
		SELECT * 
			 , CASE WHEN inquiry_answer is null THEN 'N' WHEN inquiry_answer = '' THEN 'N' ELSE 'Y' END AS inquiry_status
		  FROM TB_INQUIRY
		 WHERE 1=1
		 <if test="academy_id != null and academy_id != ''">
		 	<if test="user_id != null and user_id != ''">
		       AND user_id = #{user_id}
		       AND academy_id = #{academy_id}
		    </if>
		    <if test="user_id == null or user_id == ''">
		       AND academy_id = #{academy_id}
	       	   AND inquiry_type IN ('A', 'C')
		    </if>
	      </if>
	     <if test="academy_id == null or academy_id == ''">
	       AND inquiry_type = 'S'
	      </if>
		 ORDER BY inquiry_id DESC 
		 LIMIT #{record_count} OFFSET #{first_index}
	</select>
	
	<select id="selectInquiryListTotalCount" parameterType="SearchVO" resultType="Integer">
		SELECT COUNT(*) 
		  FROM TB_INQUIRY
		 WHERE 1=1
		 <if test="academy_id != null and academy_id != ''">
		 	<if test="user_id != null and user_id != ''">
		       AND user_id = #{user_id}
		       AND academy_id = #{academy_id}
		    </if>
		    <if test="user_id == null or user_id == ''">
		       AND user_id = #{user_id}
		       AND academy_id = #{academy_id}
	       	   AND inquiry_type IN ('A', 'C')
		    </if>
	      </if>
	     <if test="academy_id == null or academy_id == ''">
	       AND inquiry_type = 'S'
	      </if>
	</select>
	
	<select id="selectInquiryDetail" parameterType="InquiryVO" resultType="InquiryVO">
		SELECT *
			 , CASE WHEN inquiry_answer is null THEN 'N' WHEN inquiry_answer = '' THEN 'N' ELSE 'Y' END AS inquiry_status
		  FROM TB_INQUIRY
		 WHERE inquiry_id = #{inquiry_id}
	</select>
	
</mapper>