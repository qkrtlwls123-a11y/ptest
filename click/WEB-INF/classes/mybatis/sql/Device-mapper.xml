<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="device" >
	<insert id="insertDevice" parameterType="DeviceVO">
		INSERT INTO ${table_name} (
				device_name,
				product_name,
				device_no,
				device_product_id,
				mac_addr,
				company_id,
				device_desc,
				<if test="stricture_yn != null and stricture_yn != ''">
				stricture_yn,
				</if>
				<if test="auto_yn != null and auto_yn != ''">
				auto_yn,
				</if>
				<if test="retain_type != null and retain_type != ''">
				retain_type,
				</if>
				device_type,
				reg_dt,
				reg_id,
				mod_dt,
				mod_id
			)
			VALUES
			(
				#{device_name},
				#{product_name},
				#{device_no},
				#{device_product_id},
				#{mac_addr},
				#{company_id},
				#{device_desc},
				<if test="stricture_yn != null and stricture_yn != ''">
				#{stricture_yn},
				</if>
				<if test="auto_yn != null and auto_yn != ''">
				#{auto_yn},
				</if>
				<if test="retain_type != null and retain_type != ''">
				#{retain_type},
				</if>
				#{device_type},
				NOW(),
				#{reg_id},
				NOW(),
				#{mod_id}
			 )
	</insert>
	
	<select id="selectDeviceList" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT A.*
		  FROM (
			SELECT DEVICE_NAME, PRODUCT_NAME, DEVICE_NO, MAC_ADDR, 'N', reg_dt , device_use_yn , device_type, device_id , device_product_id
			  FROM TBL_DEVICE_AP
			 WHERE COMPANY_ID = #{company_id}
               <if test="device_type != null and device_type != ''">
		       AND device_type = #{device_type}
               </if>
               <if test="device_product_id != null and device_product_id != ''">
		       AND device_product_id = #{device_product_id}
               </if>
               <if test="device_use_yn != null and device_use_yn != ''">
		       AND device_use_yn = #{device_use_yn}
               </if>
               <if test="search_word != null and search_word != ''">
               AND (device_no = #{search_word} OR mac_addr LIKE CONCAT('%',#{search_word},'%'))
               </if>
			UNION ALL
			SELECT DEVICE_NAME, PRODUCT_NAME, DEVICE_NO, MAC_ADDR, 'N', reg_dt , device_use_yn , device_type, device_id , device_product_id
			  FROM TBL_DEVICE_RETAIN
			  WHERE COMPANY_ID = #{company_id}
               <if test="device_type != null and device_type != ''">
		       AND device_type = #{device_type}
               </if>
               <if test="device_product_id != null and device_product_id != ''">
		       AND device_product_id = #{device_product_id}
               </if>
               <if test="device_use_yn != null and device_use_yn != ''">
		       AND device_use_yn = #{device_use_yn}
               </if>
               <if test="search_word != null and search_word != ''">
               AND (device_no = #{search_word} OR mac_addr LIKE CONCAT('%',#{search_word},'%'))
               </if>
			UNION ALL
			SELECT DEVICE_NAME, PRODUCT_NAME, DEVICE_NO, MAC_ADDR, 'N', reg_dt , device_use_yn , device_type, device_id , device_product_id
			  FROM TBL_DEVICE_SBEACON
			 WHERE COMPANY_ID = #{company_id}
               <if test="device_type != null and device_type != ''">
		       AND device_type = #{device_type}
               </if>
               <if test="device_product_id != null and device_product_id != ''">
		       AND device_product_id = #{device_product_id}
               </if>
               <if test="device_use_yn != null and device_use_yn != ''">
		       AND device_use_yn = #{device_use_yn}
               </if>
               <if test="search_word != null and search_word != ''">
               AND (device_no = #{search_word} OR mac_addr LIKE CONCAT('%',#{search_word},'%'))
               </if>
			UNION ALL
			SELECT DEVICE_NAME, PRODUCT_NAME, DEVICE_NO, MAC_ADDR, 'N', reg_dt , device_use_yn , device_type, device_id , device_product_id
			  FROM TBL_DEVICE_TAG
			 WHERE COMPANY_ID = #{company_id}
               <if test="device_type != null and device_type != ''">
		       AND device_type = #{device_type}
               </if>
               <if test="device_product_id != null and device_product_id != ''">
		       AND device_product_id = #{device_product_id}
               </if>
               <if test="device_use_yn != null and device_use_yn != ''">
		       AND device_use_yn = #{device_use_yn}
               </if>
               <if test="search_word != null and search_word != ''">
               AND (device_no = #{search_word} OR mac_addr LIKE CONCAT('%',#{search_word},'%'))
               </if>
			UNION ALL
			 SELECT DEVICE_NAME, PRODUCT_NAME, DEVICE_NO, MAC_ADDR, 'N', reg_dt , device_use_yn , device_type, device_id , device_product_id
			  FROM TBL_DEVICE_ANEMOMETER
			 WHERE COMPANY_ID = #{company_id}
               <if test="device_type != null and device_type != ''">
		       AND device_type = #{device_type}
               </if>
               <if test="device_product_id != null and device_product_id != ''">
		       AND device_product_id = #{device_product_id}
               </if>
               <if test="device_use_yn != null and device_use_yn != ''">
		       AND device_use_yn = #{device_use_yn}
               </if>
               <if test="search_word != null and search_word != ''">
               AND (device_no = #{search_word} OR mac_addr LIKE CONCAT('%',#{search_word},'%'))
               </if>
			UNION ALL
			 SELECT DEVICE_NAME, PRODUCT_NAME, DEVICE_NO, MAC_ADDR, 'N', reg_dt , device_use_yn , device_type, device_id , device_product_id
			  FROM TBL_DEVICE_CRANE
			 WHERE COMPANY_ID = #{company_id}
               <if test="device_type != null and device_type != ''">
		       AND device_type = #{device_type}
               </if>
               <if test="device_product_id != null and device_product_id != ''">
		       AND device_product_id = #{device_product_id}
               </if>
               <if test="device_use_yn != null and device_use_yn != ''">
		       AND device_use_yn = #{device_use_yn}
               </if>
               <if test="search_word != null and search_word != ''">
               AND (device_no = #{search_word} OR mac_addr LIKE CONCAT('%',#{search_word},'%'))
               </if>
			UNION ALL
			 SELECT DEVICE_NAME, PRODUCT_NAME, DEVICE_NO, MAC_ADDR, 'N', reg_dt , device_use_yn , device_type, device_id , device_product_id
			  FROM TBL_DEVICE_CCTV
			 WHERE COMPANY_ID = #{company_id}
               <if test="device_type != null and device_type != ''">
		       AND device_type = #{device_type}
               </if>
               <if test="device_product_id != null and device_product_id != ''">
		       AND device_product_id = #{device_product_id}
               </if>
               <if test="device_use_yn != null and device_use_yn != ''">
		       AND device_use_yn = #{device_use_yn}
               </if>
               <if test="search_word != null and search_word != ''">
               AND (device_no = #{search_word} OR mac_addr LIKE CONCAT('%',#{search_word},'%'))
               </if>
               AND mac_addr IS NOT NULL
             UNION ALL
			 SELECT DEVICE_NAME, PRODUCT_NAME, DEVICE_NO, MAC_ADDR, 'N', reg_dt , device_use_yn , device_type, device_id , device_product_id
			  FROM TBL_DEVICE_FIRE
			 WHERE COMPANY_ID = #{company_id}
               <if test="device_type != null and device_type != ''">
		       AND device_type = #{device_type}
               </if>
               <if test="device_product_id != null and device_product_id != ''">
		       AND device_product_id = #{device_product_id}
               </if>
               <if test="device_use_yn != null and device_use_yn != ''">
		       AND device_use_yn = #{device_use_yn}
               </if>
               <if test="search_word != null and search_word != ''">
               AND (device_no = #{search_word} OR mac_addr LIKE CONCAT('%',#{search_word},'%'))
               </if>
               AND mac_addr IS NOT NULL
             UNION ALL
			 SELECT DEVICE_NAME, PRODUCT_NAME, DEVICE_NO, MAC_ADDR, 'N', reg_dt , device_use_yn , device_type, device_id , device_product_id
			  FROM TBL_DEVICE_FEVER
			 WHERE COMPANY_ID = #{company_id}
               <if test="device_type != null and device_type != ''">
		       AND device_type = #{device_type}
               </if>
               <if test="device_product_id != null and device_product_id != ''">
		       AND device_product_id = #{device_product_id}
               </if>
               <if test="device_use_yn != null and device_use_yn != ''">
		       AND device_use_yn = #{device_use_yn}
               </if>
               <if test="search_word != null and search_word != ''">
               AND (device_no = #{search_word} OR mac_addr LIKE CONCAT('%',#{search_word},'%'))
               </if>
               AND mac_addr IS NOT NULL
             UNION ALL
			 SELECT DEVICE_NAME, PRODUCT_NAME, DEVICE_NO, MAC_ADDR, 'N', reg_dt , device_use_yn , device_type, device_id , device_product_id
			  FROM TBL_DEVICE_SUBMERGENCE
			 WHERE COMPANY_ID = #{company_id}
               <if test="device_type != null and device_type != ''">
		       AND device_type = #{device_type}
               </if>
               <if test="device_product_id != null and device_product_id != ''">
		       AND device_product_id = #{device_product_id}
               </if>
               <if test="device_use_yn != null and device_use_yn != ''">
		       AND device_use_yn = #{device_use_yn}
               </if>
               <if test="search_word != null and search_word != ''">
               AND (device_no = #{search_word} OR mac_addr LIKE CONCAT('%',#{search_word},'%'))
               </if>
               AND mac_addr IS NOT NULL
             UNION ALL
			 SELECT DEVICE_NAME, PRODUCT_NAME, DEVICE_NO, MAC_ADDR, 'N', reg_dt , device_use_yn , device_type, device_id , device_product_id
			  FROM TBL_DEVICE_WATER
			 WHERE COMPANY_ID = #{company_id}
               <if test="device_type != null and device_type != ''">
		       AND device_type = #{device_type}
               </if>
               <if test="device_product_id != null and device_product_id != ''">
		       AND device_product_id = #{device_product_id}
               </if>
               <if test="device_use_yn != null and device_use_yn != ''">
		       AND device_use_yn = #{device_use_yn}
               </if>
               <if test="search_word != null and search_word != ''">
               AND (device_no = #{search_word} OR mac_addr LIKE CONCAT('%',#{search_word},'%'))
               </if>
               AND mac_addr IS NOT NULL
			) A
		<!-- ORDER BY A.reg_dt DESC -->
		ORDER BY ${order_column} ${order_type}
	         <if test="order_column != null and order_column != 'A.reg_dt'">
	         , ${base_order_column} ${base_order_type}
	         </if>
		
		 <if test="notUsePage == null or notUsePage == ''">
			LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
		</if>		 
	</select>
	
	<select id="selectDeviceListTotal" parameterType="DeviceVO" resultType="Integer">
		SELECT COUNT(*)
		  FROM (
			SELECT DEVICE_NAME, PRODUCT_NAME, DEVICE_NO, MAC_ADDR, 'N', reg_dt , device_use_yn , device_type, device_id
			  FROM TBL_DEVICE_AP
			 WHERE COMPANY_ID = #{company_id}
               <if test="device_type != null and device_type != ''">
		       AND device_type = #{device_type}
               </if>
               <if test="device_product_id != null and device_product_id != ''">
		       AND device_product_id = #{device_product_id}
               </if>
               <if test="device_use_yn != null and device_use_yn != ''">
		       AND device_use_yn = #{device_use_yn}
               </if>
               <if test="search_word != null and search_word != ''">
               AND (device_no = #{search_word} OR mac_addr LIKE CONCAT('%',#{search_word},'%'))
               </if>
			UNION ALL
			SELECT DEVICE_NAME, PRODUCT_NAME, DEVICE_NO, MAC_ADDR, 'N', reg_dt , device_use_yn , device_type, device_id
			  FROM TBL_DEVICE_RETAIN
			  WHERE COMPANY_ID = #{company_id}
               <if test="device_type != null and device_type != ''">
		       AND device_type = #{device_type}
               </if>
               <if test="device_product_id != null and device_product_id != ''">
		       AND device_product_id = #{device_product_id}
               </if>
               <if test="device_use_yn != null and device_use_yn != ''">
		       AND device_use_yn = #{device_use_yn}
               </if>
               <if test="search_word != null and search_word != ''">
               AND (device_no = #{search_word} OR mac_addr LIKE CONCAT('%',#{search_word},'%'))
               </if>
			UNION ALL
			SELECT DEVICE_NAME, PRODUCT_NAME, DEVICE_NO, MAC_ADDR, 'N', reg_dt , device_use_yn , device_type, device_id
			  FROM TBL_DEVICE_SBEACON
			 WHERE COMPANY_ID = #{company_id}
               <if test="device_type != null and device_type != ''">
		       AND device_type = #{device_type}
               </if>
               <if test="device_product_id != null and device_product_id != ''">
		       AND device_product_id = #{device_product_id}
               </if>
               <if test="device_use_yn != null and device_use_yn != ''">
		       AND device_use_yn = #{device_use_yn}
               </if>
               <if test="search_word != null and search_word != ''">
               AND (device_no = #{search_word} OR mac_addr LIKE CONCAT('%',#{search_word},'%'))
               </if>
			UNION ALL
			SELECT DEVICE_NAME, PRODUCT_NAME, DEVICE_NO, MAC_ADDR, 'N', reg_dt , device_use_yn , device_type, device_id
			  FROM TBL_DEVICE_TAG
			 WHERE COMPANY_ID = #{company_id}
               <if test="device_type != null and device_type != ''">
		       AND device_type = #{device_type}
               </if>
               <if test="device_product_id != null and device_product_id != ''">
		       AND device_product_id = #{device_product_id}
               </if>
               <if test="device_use_yn != null and device_use_yn != ''">
		       AND device_use_yn = #{device_use_yn}
               </if>
               <if test="search_word != null and search_word != ''">
               AND (device_no = #{search_word} OR mac_addr LIKE CONCAT('%',#{search_word},'%'))
               </if>
			UNION ALL
			 SELECT DEVICE_NAME, PRODUCT_NAME, DEVICE_NO, MAC_ADDR, 'N', reg_dt , device_use_yn , device_type, device_id
			  FROM TBL_DEVICE_ANEMOMETER
			 WHERE COMPANY_ID = #{company_id}
               <if test="device_type != null and device_type != ''">
		       AND device_type = #{device_type}
               </if>
               <if test="device_product_id != null and device_product_id != ''">
		       AND device_product_id = #{device_product_id}
               </if>
               <if test="device_use_yn != null and device_use_yn != ''">
		       AND device_use_yn = #{device_use_yn}
               </if>
               <if test="search_word != null and search_word != ''">
               AND (device_no = #{search_word} OR mac_addr LIKE CONCAT('%',#{search_word},'%'))
               </if>
			UNION ALL
			 SELECT DEVICE_NAME, PRODUCT_NAME, DEVICE_NO, MAC_ADDR, 'N', reg_dt , device_use_yn , device_type, device_id
			  FROM TBL_DEVICE_CRANE
			 WHERE COMPANY_ID = #{company_id}
               <if test="device_type != null and device_type != ''">
		       AND device_type = #{device_type}
               </if>
               <if test="device_product_id != null and device_product_id != ''">
		       AND device_product_id = #{device_product_id}
               </if>
               <if test="device_use_yn != null and device_use_yn != ''">
		       AND device_use_yn = #{device_use_yn}
               </if>
               <if test="search_word != null and search_word != ''">
               AND (device_no = #{search_word} OR mac_addr LIKE CONCAT('%',#{search_word},'%'))
               </if>
             UNION ALL
			 SELECT DEVICE_NAME, PRODUCT_NAME, DEVICE_NO, MAC_ADDR, 'N', reg_dt , device_use_yn , device_type, device_id
			  FROM TBL_DEVICE_FIRE
			 WHERE COMPANY_ID = #{company_id}
               <if test="device_type != null and device_type != ''">
		       AND device_type = #{device_type}
               </if>
               <if test="device_product_id != null and device_product_id != ''">
		       AND device_product_id = #{device_product_id}
               </if>
               <if test="device_use_yn != null and device_use_yn != ''">
		       AND device_use_yn = #{device_use_yn}
               </if>
               <if test="search_word != null and search_word != ''">
               AND (device_no = #{search_word} OR mac_addr LIKE CONCAT('%',#{search_word},'%'))
               </if>
             UNION ALL
			 SELECT DEVICE_NAME, PRODUCT_NAME, DEVICE_NO, MAC_ADDR, 'N', reg_dt , device_use_yn , device_type, device_id
			  FROM TBL_DEVICE_FEVER
			 WHERE COMPANY_ID = #{company_id}
               <if test="device_type != null and device_type != ''">
		       AND device_type = #{device_type}
               </if>
               <if test="device_product_id != null and device_product_id != ''">
		       AND device_product_id = #{device_product_id}
               </if>
               <if test="device_use_yn != null and device_use_yn != ''">
		       AND device_use_yn = #{device_use_yn}
               </if>
               <if test="search_word != null and search_word != ''">
               AND (device_no = #{search_word} OR mac_addr LIKE CONCAT('%',#{search_word},'%'))
               </if>
             UNION ALL
			 SELECT DEVICE_NAME, PRODUCT_NAME, DEVICE_NO, MAC_ADDR, 'N', reg_dt , device_use_yn , device_type, device_id
			  FROM TBL_DEVICE_SUBMERGENCE
			 WHERE COMPANY_ID = #{company_id}
               <if test="device_type != null and device_type != ''">
		       AND device_type = #{device_type}
               </if>
               <if test="device_product_id != null and device_product_id != ''">
		       AND device_product_id = #{device_product_id}
               </if>
               <if test="device_use_yn != null and device_use_yn != ''">
		       AND device_use_yn = #{device_use_yn}
               </if>
               <if test="search_word != null and search_word != ''">
               AND (device_no = #{search_word} OR mac_addr LIKE CONCAT('%',#{search_word},'%'))
               </if>
             UNION ALL
			 SELECT DEVICE_NAME, PRODUCT_NAME, DEVICE_NO, MAC_ADDR, 'N', reg_dt , device_use_yn , device_type, device_id
			  FROM TBL_DEVICE_WATER
			 WHERE COMPANY_ID = #{company_id}
               <if test="device_type != null and device_type != ''">
		       AND device_type = #{device_type}
               </if>
               <if test="device_product_id != null and device_product_id != ''">
		       AND device_product_id = #{device_product_id}
               </if>
               <if test="device_use_yn != null and device_use_yn != ''">
		       AND device_use_yn = #{device_use_yn}
               </if>
               <if test="search_word != null and search_word != ''">
               AND (device_no = #{search_word} OR mac_addr LIKE CONCAT('%',#{search_word},'%'))
               </if>
			) A
	</select>

	<select id="selectDiviceNo" parameterType="DeviceVO" resultType="DeviceVO">
		<![CDATA[
		SELECT DEVICE.DEVICE_NO
		  FROM (
				SELECT CASE WHEN MIN(A.SEQ) is NULL THEN 1 ELSE MIN(A.SEQ) END AS DEVICE_NO
				  FROM seq_1_to_10000 A
						 LEFT OUTER JOIN (
						 					]]>
						 					SELECT * 
						 					  FROM ${table_name} 
						 					 WHERE COMPANY_ID = #{company_id} 
						 					 <if test="stricture_yn != null and stricture_yn != ''">
						 					   AND stricture_yn = #{stricture_yn}
						 					 </if>
						 					 <![CDATA[
						 				 ) B 
						 				 ON (B.DEVICE_NO = A.SEQ)
				 WHERE B.DEVICE_NO IS NULL
				   AND A.SEQ <= (
									SELECT MAX(dn.DEVICE_NO)  
									  FROM ${table_name} dn
									 WHERE dn.COMPANY_ID = #{company_id}
									 ]]>
									 <if test="stricture_yn != null and stricture_yn != ''">
									   AND dn.stricture_yn = #{stricture_yn}
									  </if>
								)
				UNION ALL
				SELECT CASE WHEN (MAX(DEVICE_NO)+1) is NULL THEN 1 ELSE (MAX(DEVICE_NO)+1) END AS DEVICE_NO
				  FROM ${table_name}
				 WHERE COMPANY_ID = #{company_id}
				<if test="stricture_yn != null and stricture_yn != ''">
				   AND stricture_yn = #{stricture_yn}
				</if>
				) DEVICE
		  GROUP BY DEVICE.DEVICE_NO
	</select>
	
	<select id="checkDeviceNo" parameterType="DeviceVO" resultType="Integer">
		SELECT COUNT(*)
		  FROM ${table_name}
		 WHERE device_no = #{device_no}
		   AND company_id = #{company_id}
		  <if test="stricture_yn != null and stricture_yn != ''">
		   AND stricture_yn = #{stricture_yn}
		  </if>
	</select>
	
	<select id="checkDeviceNoDetail" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT * 
		FROM ${table_name} 
		WHERE 1=1 
		AND company_id = #{company_id}
		<if test="device_no != null and device_no != ''">
		AND device_no = #{device_no}
		</if> 
		<if test="mac_addr != null and mac_addr != ''">
		AND mac_addr = #{mac_addr}
		</if> 
	</select>
	
	<select id="checkTagMapping" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT *
		  FROM TBL_MAPPING_TAG
		 WHERE status = #{status}
		 <if test="device_no != null and device_no != ''">
		 AND device_no = #{device_no}
		 </if> 
		 <if test="mac_addr != null and mac_addr != ''">
		 AND mac_addr = #{mac_addr}
		 </if> 
		 AND company_id = #{company_id}
	</select>
	
	<select id="selectSiteDeviceNoList" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT DEVICE_ID, DEVICE_NAME, PRODUCT_NAME, DEVICE_NO
			<if test="table_name == 'TBL_DEVICE_RETAIN'">
		    , retain_type
		   </if>
		  FROM ${table_name}
		 WHERE company_id = #{company_id}
		 	<if test="stricture_yn != null and stricture_yn != ''">
		   AND stricture_yn = #{stricture_yn}
		   </if>
		   AND device_use_yn = 'N'
	</select>
	
	<select id="selectDeviceListAll" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT B.DEVICE_CODE
			 , A.DEVICE_TYPE
			 , B.DEVICE_NAME
			 , A.stricture_yn
		  FROM (
			SELECT DEVICE_TYPE, DEVICE_NAME, PRODUCT_NAME, stricture_yn   
			  FROM TBL_DEVICE_AP
			 WHERE COMPANY_ID = #{company_id}
			   AND stricture_yn = 'N'
			UNION ALL
			SELECT DEVICE_TYPE, DEVICE_NAME, PRODUCT_NAME, stricture_yn 
			  FROM TBL_DEVICE_AP
			 WHERE COMPANY_ID = #{company_id}
			   AND stricture_yn = 'Y'
			UNION ALL
			SELECT DEVICE_TYPE, DEVICE_NAME, PRODUCT_NAME, 'N' 
			  FROM TBL_DEVICE_RETAIN
			  WHERE COMPANY_ID = #{company_id}
			UNION ALL
			SELECT DEVICE_TYPE, DEVICE_NAME, PRODUCT_NAME, 'N' 
			  FROM TBL_DEVICE_SBEACON
			 WHERE COMPANY_ID = #{company_id}
			UNION ALL
			SELECT DEVICE_TYPE, DEVICE_NAME, PRODUCT_NAME, 'N' 
			  FROM TBL_DEVICE_TAG
			 WHERE COMPANY_ID = #{company_id}
			UNION ALL
			 SELECT DEVICE_TYPE, DEVICE_NAME, PRODUCT_NAME, 'N'
			  FROM TBL_DEVICE_ANEMOMETER
			 WHERE COMPANY_ID = #{company_id}
			UNION ALL
			 SELECT DEVICE_TYPE, DEVICE_NAME, PRODUCT_NAME, 'N'
			  FROM TBL_DEVICE_CRANE
			 WHERE COMPANY_ID = #{company_id}
			UNION ALL
			 SELECT DEVICE_TYPE, DEVICE_NAME, PRODUCT_NAME, 'N'
			  FROM TBL_DEVICE_FEVER
			 WHERE COMPANY_ID = #{company_id}
			UNION ALL
			 SELECT DEVICE_TYPE, DEVICE_NAME, PRODUCT_NAME, 'N'
			  FROM TBL_DEVICE_SUBMERGENCE
			 WHERE COMPANY_ID = #{company_id}
			UNION ALL
			 SELECT DEVICE_TYPE, DEVICE_NAME, PRODUCT_NAME, 'N'
			  FROM TBL_DEVICE_WATER
			 WHERE COMPANY_ID = #{company_id}
			UNION ALL
			 SELECT DEVICE_TYPE, DEVICE_NAME, PRODUCT_NAME, 'N'
			  FROM TBL_DEVICE_FIRE
			 WHERE COMPANY_ID = #{company_id}
			) A, TBL_DEVICE_TYPE B
		 WHERE A.DEVICE_TYPE = B.DEVICE_CODE
		 GROUP BY DEVICE_CODE, DEVICE_TYPE, DEVICE_NAME, stricture_yn
	</select>
	
	<select id="selectDeviceDetail" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT *
		  FROM ${table_name}
		 WHERE DEVICE_ID = #{device_id}
		   AND COMPANY_ID = #{company_id}
	</select>
	
	<update id="updateDevice" parameterType="DeviceVO">
		UPDATE ${table_name}
		   SET    device_desc = #{device_desc}
		   		, mod_dt = NOW()
		   		, mod_id = #{mod_id}
		   <if test="device_no != null and device_no != ''">
		   		, device_no = #{device_no}
		   </if>
		   <if test="mac_addr != null and mac_addr != ''">
		   		, mac_addr = #{mac_addr}
		   </if>
		   <if test="auto_yn != null and auto_yn != ''">
		   		, auto_yn = #{auto_yn}
		   </if>
		 WHERE company_id = #{company_id}
		   AND device_id = #{device_id}
	</update>	
	
	<delete id="deleteDevice" parameterType="DeviceVO">
		DELETE FROM ${table_name} WHERE company_id = #{company_id}
		   AND device_no = #{device_no}
		   AND device_type = #{device_type}
	</delete>
	

	<select id="selectDeviceMacAddress" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT *
		  FROM ${table_name}
		 WHERE company_id = #{company_id}
		   AND device_id = #{device_id}
	</select>
	
	<select id="selectBuildingList" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT building_id, company_id, building_name_eng, group_id, scene_id, reg_dt, reg_id, mod_dt, mod_id
			<if test="locale == 'en'">
			   ,building_name_eng AS building_name  <!--  SELECT 파라미터 설정이 뒤에서 부터이므로, Rewrite됨. -->
			</if>
			,building_name
			
		  FROM TBL_BUILDING
		 WHERE company_id = #{company_id}
	</select>
	
	<select id="selectZoneList" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT zone_id ,company_id ,building_id ,area_type_id ,floor_eng ,group_id ,scene_id ,reg_dt ,reg_id ,mod_dt ,mod_id
			<if test="locale == 'en'">
			   ,floor_eng AS floor  <!--  SELECT 파라미터 설정이 뒤에서 부터이므로, Rewrite됨. -->
			</if>
			 ,floor
			
		  FROM TBL_ZONE
		 WHERE building_id = #{building_id}
		   AND company_id = #{company_id}
	</select>
	
	<select id="selectCellList" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT cell_id ,company_id ,building_id ,zone_id ,cell_name_eng ,area_type_id ,poi_id 
		      ,unregi_alram_yn ,tbm_yn ,holder_yn ,watch_area_yn ,coord_list ,reg_dt ,reg_id ,mod_dt ,mod_id
			<if test="locale == 'en'">
			   ,cell_name_eng AS cell_name  <!--  SELECT 파라미터 설정이 뒤에서 부터이므로, Rewrite됨. -->
			</if>
			  ,cell_name
		  FROM TBL_CELL
		 WHERE building_id = #{building_id}
		   AND zone_id = #{zone_id}
		   AND company_id = #{company_id}
	</select>
	
	<insert id="insertMappingDevice" parameterType="DeviceVO">
		INSERT INTO TBL_MAPPING_DEVICE ( 
				device_id,
				device_type,
				device_no,
				product_name,
				building_id,
				zone_id,
				cell_id,
				status,
				map_dt,
				unmap_dt,
				setting_value,
				manage_value,
				wind_warning_threshold,
				wind_danger_threshold,
				crane_type,
				jib_length,
				counter_jib_length,
				warning_distance,
				danger_distance,
				trolly_warning_distance,
				trolly_danger_distance,
				retain_type,
				gas_id,
				worker_id,
				worker_id2,
				worker_radious,
				reg_dt,
				reg_id,
				mod_dt,
				mod_id,
				company_id,
				mac_addr,
				check_out_type,
				fever_threshold,
				fever_file_id
			)
			VALUES
			(
				#{device_id},
				#{device_type},
				#{device_no},
				#{product_name},
				#{building_id},
				#{zone_id},
				#{cell_id},
				#{status},
				NOW(),
				#{unmap_dt},
				#{setting_value},
				#{manage_value},
				#{wind_warning_threshold},
				#{wind_danger_threshold},
				#{crane_type},
				#{jib_length},
				#{counter_jib_length},
				#{warning_distance},
				#{danger_distance},
				#{trolly_warning_distance},
				#{trolly_danger_distance},
				#{retain_type},
				#{gas_id},
				#{worker_id},
				#{worker_id2},
				#{worker_radious},
				NOW(),
				#{reg_id},
				NOW(),
				#{mod_id},
				#{company_id},
				#{mac_addr},
				#{check_out_type},
				#{fever_threshold},
				#{fever_file_id}
			 ) on duplicate key 
		update device_no = #{device_no}
			 , building_id = #{building_id}
			 , zone_id = #{zone_id}
			 , cell_id = #{cell_id}
			 , status = #{status}
			 , map_dt = NOW()
			 , unmap_dt = NOW()
			 , setting_value = #{setting_value}
			 , manage_value = #{manage_value}
			 , wind_warning_threshold = #{wind_warning_threshold}
			 , wind_danger_threshold = #{wind_danger_threshold}
			 , crane_type = #{crane_type}
			 , jib_length = #{jib_length}
			 , counter_jib_length = #{counter_jib_length}
			 , warning_distance = #{warning_distance}
			 , danger_distance = #{danger_distance}
			 , trolly_warning_distance = #{trolly_warning_distance}
			 , trolly_danger_distance = #{trolly_danger_distance}
			 , retain_type = #{retain_type}
			 , gas_id = #{gas_id}
			 , worker_id = #{worker_id}
			 , worker_id2 = #{worker_id2}
			 , worker_radious = #{worker_radious}
			 , mod_dt = NOW()
			 , mod_id = #{mod_id}
			 , mac_addr = #{mac_addr}
			 , check_out_type = #{check_out_type}
			 , fever_threshold = #{fever_threshold}
			 , fever_file_id = #{fever_file_id}
	</insert>
	
	<update id="updateDeviceUseYN" parameterType="DeviceVO">
		UPDATE ${table_name}
		   SET device_use_yn = #{device_use_yn}
		 WHERE mac_addr = #{mac_addr}
		   AND company_id = #{company_id}
	</update>
	
	<insert id="insertMappingTag" parameterType="DeviceVO">
		INSERT INTO TBL_MAPPING_TAG ( 
				device_no,
				mac_addr,
				worker_id,
				user_type,
				status,
				company_id,
				reg_dt,
				reg_id
			)
			VALUES
			(
				#{device_no},
				#{mac_addr},
				#{worker_id},
				#{user_type},
				#{status},
				#{company_id},
				NOW(),
				#{reg_id}
			 ) on duplicate key 
		update device_no = #{device_no}
			 , worker_id = #{worker_id}
			 , user_type = #{user_type}
			 , status = #{status}
			 , company_id = #{company_id}
			 , mod_dt = NOW()
			 , mod_id = #{mod_id}
	</insert>
	
	<select id="selectMappingDeviceListAll" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT A.*
			 , (SELECT WORKER_NAME FROM TBL_WORKER B WHERE A.WORKER_ID = B.WORKER_ID AND B.company_id = #{company_id} LIMIT 1) AS WORKER_NAME
			 , (SELECT WORKER_NAME FROM TBL_WORKER B WHERE A.WORKER_ID2 = B.WORKER_ID AND B.company_id = #{company_id} LIMIT 1) AS WORKER_NAME2
			 , (SELECT DEVICE_NAME FROM TBL_DEVICE_TYPE B WHERE A.DEVICE_TYPE = B.DEVICE_CODE LIMIT 1) AS DEVICE_NAME
			 , (SELECT scene_id FROM TBL_ZONE B WHERE A.ZONE_ID = B.ZONE_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS scene_id
			 , (SELECT poi_id FROM TBL_CELL B WHERE A.CELL_ID = B.CELL_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS poi_id			 
			 <if test="locale == 'en'">
			 , (SELECT BUILDING_NAME_ENG FROM TBL_BUILDING B WHERE A.BUILDING_ID = B.BUILDING_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS BUILDING_NAME
			 , (SELECT FLOOR_ENG FROM TBL_ZONE B WHERE A.ZONE_ID = B.ZONE_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS FLOOR
			 , (SELECT CELL_NAME_ENG FROM TBL_CELL B WHERE A.CELL_ID = B.CELL_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS CELL_NAME
			</if>
			 <if test="locale != 'en'">
			 , (SELECT BUILDING_NAME FROM TBL_BUILDING B WHERE A.BUILDING_ID = B.BUILDING_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS BUILDING_NAME
			 , (SELECT FLOOR FROM TBL_ZONE B WHERE A.ZONE_ID = B.ZONE_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS FLOOR
			 , (SELECT CELL_NAME FROM TBL_CELL B WHERE A.CELL_ID = B.CELL_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS CELL_NAME
			 </if>
		  FROM TBL_MAPPING_DEVICE A
		 WHERE 1=1
		   AND company_id = #{company_id}
		   <if test="building_id != null and building_id != ''">
		   AND building_id = #{building_id}
		   </if>
		   <if test="zone_id != null and zone_id != ''">
		   AND zone_id = #{zone_id}
		   </if>
		   <if test="cell_id != null and cell_id != ''">
		   AND cell_id = #{cell_id}
		   </if>
		   <if test="device_type != null and device_type != ''">
		   AND device_type = #{device_type}
		   </if>
		   <if test="search_word != null and search_word != ''">
		   AND (device_no = #{search_word} OR product_name LIKE CONCAT('%',#{search_word},'%'))
		   </if>
		   <if test="notUsePage == null or notUsePage == ''">
		   ORDER BY map_dt DESC
		   </if>
		   <if test="notUsePage != null and notUsePage != ''">
			 <if test="order_type != null and order_type != ''">
	           ORDER BY device_no ASC, map_dt ${order_type}
	         </if>
	         <if test="order_type == null or order_type == ''">
	           ORDER BY device_no ASC, map_dt DESC
	         </if>
		   </if>
	</select> 
	
	<select id="selectMappingDeviceList" parameterType="DeviceVO" resultType="DeviceVO">
	    SELECT     X.*
			    , (SELECT MAX(firmware_version) FROM TBL_DEVICE_FIRMWARE TDF WHERE TDF.device_product_id = X.device_product_id LIMIT 1 ) AS firmware_version
		FROM(
			SELECT A.*
				 , (SELECT DEVICE_NAME FROM TBL_DEVICE_TYPE B WHERE A.DEVICE_TYPE = B.DEVICE_CODE LIMIT 1) AS DEVICE_NAME
				 , (SELECT device_product_id FROM TBL_DEVICE_AP B WHERE A.device_no = B.device_no AND B.COMPANY_ID = #{company_id} AND A.device_type = B.device_type LIMIT 1 ) AS device_product_id
				 , DATE_FORMAT( A.reg_dt , '%Y/%m/%d %H:%i') AS reg_dt_report 
				<if test="locale == 'en'">
				 , (SELECT BUILDING_NAME_ENG FROM TBL_BUILDING B WHERE A.BUILDING_ID = B.BUILDING_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS BUILDING_NAME
				 , (SELECT FLOOR_ENG FROM TBL_ZONE B WHERE A.ZONE_ID = B.ZONE_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS FLOOR
				 , (SELECT CELL_NAME_ENG FROM TBL_CELL B WHERE A.CELL_ID = B.CELL_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS CELL_NAME
				</if>
				<if test="locale != 'en'">
				 , (SELECT BUILDING_NAME FROM TBL_BUILDING B WHERE A.BUILDING_ID = B.BUILDING_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS BUILDING_NAME
				 , (SELECT FLOOR FROM TBL_ZONE B WHERE A.ZONE_ID = B.ZONE_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS FLOOR
				 , (SELECT CELL_NAME FROM TBL_CELL B WHERE A.CELL_ID = B.CELL_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS CELL_NAME
				</if>
				 
			  FROM TBL_MAPPING_DEVICE A
			 WHERE 1=1
			   AND company_id = #{company_id}
			   <if test="building_id != null and building_id != ''">
			   AND building_id = #{building_id}
			   </if>
			   <if test="zone_id != null and zone_id != ''">
			   AND zone_id = #{zone_id}
			   </if>
			   <if test="cell_id != null and cell_id != ''">
			   AND cell_id = #{cell_id}
			   </if>
			   <if test="device_type != null and device_type != ''">
			   AND device_type = #{device_type}
			   </if>
			   <if test="retain_type != null and retain_type != ''">
			   AND retain_type = #{retain_type}
			   </if>
			   <if test="search_word != null and search_word != ''">
			   AND (device_no = #{search_word} OR product_name LIKE CONCAT('%',#{search_word},'%'))
			   </if>
			   <if test="mac_addr != null and mac_addr != ''">
			   AND mac_addr = #{mac_addr}
			   </if>
			   <if test="device_id != null and device_id != ''">
			   AND device_id = #{device_id}
			   </if>
		 ) X
		 <if test="order_type != null and order_type != ''">
           ORDER BY X.map_dt ${order_type}
         </if>
         <if test="order_type == null or order_type == ''">
           ORDER BY X.map_dt DESC
         </if>
		 <if test="notUsePage == null or notUsePage == ''">
			LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
		</if>		 
	</select>
	
	<select id="selectMappingDeviceListTotal" parameterType="DeviceVO" resultType="Integer">
		SELECT COUNT(*)
		  FROM TBL_MAPPING_DEVICE
		 WHERE 1=1
		   AND company_id = #{company_id}
		   <if test="building_id != null and building_id != ''">
		   AND building_id = #{building_id}
		   </if>
		   <if test="zone_id != null and zone_id != ''">
		   AND zone_id = #{zone_id}
		   </if>
		   <if test="cell_id != null and cell_id != ''">
		   AND cell_id = #{cell_id}
		   </if>
		   <if test="device_type != null and device_type != ''">
		   AND device_type = #{device_type}
		   </if>
		   <if test="retain_type != null and retain_type != ''">
		   AND retain_type = #{retain_type}
		   </if>
		   <if test="search_word != null and search_word != ''">
		   AND (device_no = #{search_word} OR product_name LIKE CONCAT('%',#{search_word},'%'))
		   </if>
		   <if test="mac_addr != null and mac_addr != ''">
		   AND mac_addr = #{mac_addr}
		   </if>
		   <if test="device_id != null and device_id != ''">
		   AND device_id = #{device_id}
		   </if>
		   <if test="device_no != null and device_no != ''">
		   AND device_no = #{device_no}
		   </if>
	</select>
	
	<select id="selectMappingTagListTotal" parameterType="DeviceVO" resultType="Integer">
		SELECT COUNT(*)
		  FROM TBL_MAPPING_TAG
		 WHERE 1=1
		   AND company_id = #{company_id}
		   <if test="search_word != null and search_word != ''">
		   AND (device_no = #{search_word} OR product_name LIKE CONCAT('%',#{search_word},'%'))
		   </if>
		   <if test="mac_addr != null and mac_addr != ''">
		   AND mac_addr = #{mac_addr}
		   </if>
		   <if test="worker_id != null and worker_id != ''">
		   AND worker_id = #{worker_id}
		   </if>
		   <if test="device_no != null and device_no != ''">
		   AND device_no = #{device_no}
		   </if>
	</select>
	
	<select id="selectRetainCollectList" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT A.device_no
			 , A.device_type
			 , A.reg_dt
			 , A.retain_type
			 , A.setting_value
			 , A.manage_value
			 , A.mac_addr
			 , A.product_name
			 , A.auto_yn
			 <if test="locale == 'en'">
			 , (SELECT DEVICE_NAME_ENG FROM TBL_DEVICE_TYPE B WHERE A.DEVICE_TYPE = B.DEVICE_CODE LIMIT 1) AS DEVICE_NAME
			 , (SELECT BUILDING_NAME_ENG FROM TBL_BUILDING B WHERE A.BUILDING_ID = B.BUILDING_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS BUILDING_NAME
			 , (SELECT FLOOR_ENG FROM TBL_ZONE B WHERE A.ZONE_ID = B.ZONE_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS FLOOR
			 , (SELECT CELL_NAME_ENG FROM TBL_CELL B WHERE A.CELL_ID = B.CELL_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS CELL_NAME
			 </if>
			 <if test="locale != 'en'">
			 , (SELECT DEVICE_NAME FROM TBL_DEVICE_TYPE B WHERE A.DEVICE_TYPE = B.DEVICE_CODE LIMIT 1) AS DEVICE_NAME
			 , (SELECT BUILDING_NAME FROM TBL_BUILDING B WHERE A.BUILDING_ID = B.BUILDING_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS BUILDING_NAME
			 , (SELECT FLOOR FROM TBL_ZONE B WHERE A.ZONE_ID = B.ZONE_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS FLOOR
			 , (SELECT CELL_NAME FROM TBL_CELL B WHERE A.CELL_ID = B.CELL_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS CELL_NAME
			 </if>
			 , R.measure_value
			 , R.max_variation_depth
			 , R.max_variation_measure
			 , R.measure_dt
			 , R.retain_id
			 , R.threshold
		  FROM TBL_MAPPING_DEVICE A 
		  		LEFT OUTER JOIN (
		  							SELECT * 
		  							  FROM TBL_COLLECT_RETAIN 
		  							 WHERE 1=1
		  							 <if test="historyUse != null or historyUse != ''">
									   <if test="retain_type != null and retain_type != '' and retain_type = 'U'">
									   AND max_variation_measure IS NOT NULL
									   </if>
									   <if test="retain_type != null and retain_type != '' and retain_type != 'U'">
									   AND measure_value IS NOT NULL
									   </if>
							   		</if>
		  						) R ON A.mac_addr = R.retain_id AND A.retain_type = R.retain_type
		 WHERE 1=1
		   AND A.company_id = #{company_id}
		   AND A.retain_type = #{retain_type}
		   AND A.device_type = #{device_type}
		   <if test="auto_yn != null and auto_yn != ''">
		   AND A.auto_yn = #{auto_yn}
		   </if>
		   <if test="building_id != null and building_id != ''">
		   AND A.building_id = #{building_id}
		   </if>
		   <if test="zone_id != null and zone_id != ''">
		   AND A.zone_id = #{zone_id}
		   </if>
		   <if test="cell_id != null and cell_id != ''">
		   AND A.cell_id = #{cell_id}
		   </if>
		   <if test="device_no != null and device_no != ''">
		   AND A.device_no = #{device_no}
		   </if>
		   <if test="start_date != null and start_date != ''">
		   AND R.measure_dt BETWEEN STR_TO_DATE(CONCAT(#{start_date}, ' 00:00:00'),'%Y-%m-%d %H:%i:%s') AND STR_TO_DATE(CONCAT(#{end_date}, '23:59:59'),'%Y-%m-%d %H:%i:%s')
		   </if>
		   <if test="search_word != null and search_word != ''">
		   AND (A.device_no = #{search_word} OR A.product_name LIKE CONCAT('%',#{search_word},'%'))
		   </if>
		 ORDER BY R.measure_dt ${order_type}
		 <if test="notUsePage == null or notUsePage == ''">
			LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
		</if>		 
	</select>
	
	<select id="selectRetainCollectListTotal" parameterType="DeviceVO" resultType="Integer">
		SELECT COUNT(*)
		  FROM TBL_MAPPING_DEVICE A 
		  		LEFT OUTER JOIN (
		  							SELECT * 
		  							  FROM TBL_COLLECT_RETAIN 
		  							 WHERE 1=1
		  							 <if test="historyUse != null or historyUse != ''">
									   <if test="retain_type != null and retain_type != '' and retain_type = 'U'">
									   AND max_variation_measure IS NOT NULL
									   </if>
									   <if test="retain_type != null and retain_type != '' and retain_type != 'U'">
									   AND measure_value IS NOT NULL
									   </if>
							   		</if>
		  						) R ON A.mac_addr = R.retain_id AND A.retain_type = R.retain_type
		 WHERE 1=1
		   AND A.company_id = #{company_id}
		   AND A.retain_type = #{retain_type}
		   AND A.device_type = #{device_type}
		   <if test="auto_yn != null and auto_yn != ''">
		   AND A.auto_yn = #{auto_yn}
		   </if>
		   <if test="building_id != null and building_id != ''">
		   AND A.building_id = #{building_id}
		   </if>
		   <if test="zone_id != null and zone_id != ''">
		   AND A.zone_id = #{zone_id}
		   </if>
		   <if test="cell_id != null and cell_id != ''">
		   AND A.cell_id = #{cell_id}
		   </if>
		   <if test="device_no != null and device_no != ''">
		   AND A.device_no = #{device_no}
		   </if>
		   <if test="start_date != null and start_date != ''">
		   AND R.measure_dt BETWEEN STR_TO_DATE(CONCAT(#{start_date}, ' 00:00:00'),'%Y-%m-%d %H:%i:%s') AND STR_TO_DATE(CONCAT(#{end_date}, '23:59:59'),'%Y-%m-%d %H:%i:%s')
		   </if>
		   <if test="search_word != null and search_word != ''">
		   AND (A.device_no = #{search_word} OR A.product_name LIKE CONCAT('%',#{search_word},'%'))
		   </if>
	</select>
	
	<select id="selectRetainCollectList2" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT A.device_no
			 , A.device_type
			 , A.reg_dt
			 , A.retain_type
			 , A.setting_value
			 , A.manage_value
			 , A.mac_addr
			 , A.product_name
			 , A.auto_yn
			 <if test="locale == 'en'">
			 , (SELECT DEVICE_NAME_ENG FROM TBL_DEVICE_TYPE B WHERE A.DEVICE_TYPE = B.DEVICE_CODE LIMIT 1) AS DEVICE_NAME
			 , (SELECT BUILDING_NAME_ENG FROM TBL_BUILDING B WHERE A.BUILDING_ID = B.BUILDING_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS BUILDING_NAME
			 , (SELECT FLOOR_ENG FROM TBL_ZONE B WHERE A.ZONE_ID = B.ZONE_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS FLOOR
			 , (SELECT CELL_NAME_ENG FROM TBL_CELL B WHERE A.CELL_ID = B.CELL_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS CELL_NAME
			 </if>
			 <if test="locale != 'en'">
			 , (SELECT DEVICE_NAME FROM TBL_DEVICE_TYPE B WHERE A.DEVICE_TYPE = B.DEVICE_CODE LIMIT 1) AS DEVICE_NAME
			 , (SELECT BUILDING_NAME FROM TBL_BUILDING B WHERE A.BUILDING_ID = B.BUILDING_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS BUILDING_NAME
			 , (SELECT FLOOR FROM TBL_ZONE B WHERE A.ZONE_ID = B.ZONE_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS FLOOR
			 , (SELECT CELL_NAME FROM TBL_CELL B WHERE A.CELL_ID = B.CELL_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS CELL_NAME
			 </if>
			 , R.measure_value
			 , R.max_variation_depth
			 , R.max_variation_measure
			 , R.measure_dt
			 , R.retain_id
		  FROM TBL_MAPPING_DEVICE A LEFT OUTER JOIN TBL_COLLECT_RETAIN R ON A.mac_addr = R.retain_id AND A.retain_type = R.retain_type
		 WHERE 1=1
		   AND A.company_id = #{company_id}
		   AND A.retain_type = #{retain_type}
		   AND A.device_type = #{device_type}
		   <if test="auto_yn != null and auto_yn != ''">
		   AND A.auto_yn = #{auto_yn}
		   </if>
		   <if test="building_id != null and building_id != ''">
		   AND A.building_id = #{building_id}
		   </if>
		   <if test="zone_id != null and zone_id != ''">
		   AND A.zone_id = #{zone_id}
		   </if>
		   <if test="cell_id != null and cell_id != ''">
		   AND A.cell_id = #{cell_id}
		   </if>
		   <if test="device_no != null and device_no != ''">
		   AND A.device_no = #{device_no}
		   </if>
		   <if test="start_date != null and start_date != ''">
		   AND R.measure_dt BETWEEN STR_TO_DATE(#{start_date},'%Y-%m-%d %H:%i:%s') AND STR_TO_DATE(#{end_date},'%Y-%m-%d %H:%i:%s')
		   </if>
		   <if test="search_word != null and search_word != ''">
		   AND (A.device_no = #{search_word} OR A.product_name LIKE CONCAT('%',#{search_word},'%'))
		   </if>
		 ORDER BY R.measure_dt ASC
	</select>
	
	<select id="selectWorkerMappingTag" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT *
		  FROM TBL_MAPPING_TAG
		 WHERE worker_id = #{worker_id}
		 AND company_id = #{company_id}
	</select>
	
	<update id="updateTagStatus" parameterType="DeviceVO">
		 UPDATE TBL_MAPPING_TAG
		    SET status = #{status}
		   	   , mod_dt = NOW()
		   	   <if test="mod_id != null and mod_id != ''">
		   	   , mod_id = #{mod_id}
		   	   </if> 
		 WHERE worker_id = #{worker_id}
		 AND company_id = #{company_id}
	</update>
	
	<update id="updateMappingTag" parameterType="DeviceVO">
		 UPDATE TBL_MAPPING_TAG
		 SET      mod_dt 	 = NOW()
		        , mod_id 	 = #{mod_id}
		 		, device_no  = #{device_no}
		 		, mac_addr   = #{mac_addr}
		 WHERE company_id = #{company_id}
		 AND worker_id = #{worker_id} 
	</update>
	
	<update id="deleteMappingTag" parameterType="DeviceVO">
		 DELETE FROM TBL_MAPPING_TAG
		 WHERE company_id   = #{company_id}
		 AND device_no   = #{device_no}
		 <if test="mac_addr != null and mac_addr != ''">
		 AND mac_addr  = #{mac_addr}
		 </if>
	</update>
	
	<select id="selectZoneDetail" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT *
		  FROM TBL_ZONE
		 WHERE zone_id = #{zone_id}
		   AND company_id = #{company_id}
	</select>
	
	<select id="selectCellDetail" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT *
		  FROM TBL_CELL
		 WHERE cell_id = #{cell_id}
		   AND company_id = #{company_id}
	</select>
	
	<select id="selectGasStatusDetailList" parameterType="SBeaconCollectVO" resultType="SBeaconCollectVO">
		SELECT mac_addr, ap_mac_addr, CONCAT(oxygen_value, '.', oxygen_point_value) AS oxygen_value
			 , carbon_monoxide_value
			 , hydrogen_sulfide_value
			 , methan_value
			 , CONCAT(temperature_value, '.', temperature_point_value) AS temperature_value
			 , humidity
			 , DATE_FORMAT(A.reg_dt,'%Y-%m-%d %H:%i') AS reg_dt
			 , threshold
		   FROM TBL_COLLECT_SBEACON A
		  WHERE A.reg_dt in (
							SELECT ANO.reg_dt
							  FROM (
									 SELECT MAX(reg_dt) AS reg_dt, DATE_FORMAT(reg_dt,'%Y-%m-%d %H:%i') AS time
											  FROM TBL_COLLECT_SBEACON
											 WHERE 1=1
											   AND reg_dt BETWEEN STR_TO_DATE(CONCAT(#{start_date}, #{start_time}, ':00:00'),'%Y-%m-%d %H:%i:%s') AND STR_TO_DATE(CONCAT(#{start_date}, #{end_time}, ':59:59'),'%Y-%m-%d %H:%i:%s')
											   AND mac_addr = #{mac_addr}
											 GROUP BY time
									 ) ANO
							)
		    AND A.mac_addr = #{mac_addr}
	</select>
	
	<select id="selectGasStatusList" parameterType="SBeaconCollectVO" resultType="SBeaconCollectVO">
		SELECT *
			 , (SELECT BUILDING_NAME FROM TBL_BUILDING C WHERE B.BUILDING_ID = C.BUILDING_ID AND C.COMPANY_ID = #{company_id} LIMIT 1) AS BUILDING_NAME
			 , (SELECT FLOOR FROM TBL_ZONE D WHERE B.ZONE_ID = D.ZONE_ID AND D.COMPANY_ID = #{company_id} LIMIT 1) AS ZONE_NAME
			 , (SELECT CELL_NAME FROM TBL_CELL E WHERE B.CELL_ID = E.CELL_ID AND E.COMPANY_ID = #{company_id} LIMIT 1) AS CELL_NAME
			 , (SELECT BUILDING_NAME_ENG FROM TBL_BUILDING C WHERE B.BUILDING_ID = C.BUILDING_ID AND C.COMPANY_ID = #{company_id} LIMIT 1) AS BUILDING_NAME_ENG
			 , (SELECT FLOOR_ENG FROM TBL_ZONE D WHERE B.ZONE_ID = D.ZONE_ID AND D.COMPANY_ID = #{company_id} LIMIT 1) AS FLOOR_ENG
			 , (SELECT CELL_NAME_ENG FROM TBL_CELL E WHERE B.CELL_ID = E.CELL_ID AND E.COMPANY_ID = #{company_id} LIMIT 1) AS CELL_NAME_ENG
		  FROM (
				SELECT mac_addr, ap_mac_addr, CONCAT(oxygen_value, '.', oxygen_point_value) AS oxygen_value
					 , carbon_monoxide_value
					 , hydrogen_sulfide_value
					 , methan_value
					 , CONCAT(temperature_value, '.', temperature_point_value) AS temperature_value
					 , humidity
					 , reg_dt
				  FROM TBL_COLLECT_SBEACON
				 WHERE 1=1
				 <choose>
		            <when test="macAddressList.size != 0">
		                and mac_addr in 
		                <foreach collection="macAddressList" item="item" index="index" separator="," open="(" close=")">
		                    #{item}
		                </foreach>
		            </when>
		        </choose>
		        <if test="start_date != null and start_date != ''">
		        	<![CDATA[
				    AND reg_dt >= STR_TO_DATE(CONCAT(#{start_date}, #{start_time}, ':00:00'),'%Y-%m-%d %H:%i:%s')
				    ]]>
				 </if>
				 <if test="end_date != null and end_date != ''">
		        	<![CDATA[
				    AND reg_dt <= STR_TO_DATE(CONCAT(#{end_date}, #{end_time}, ':59:59'),'%Y-%m-%d %H:%i:%s')
				    ]]>
				 </if>
		        ) A, TBL_MAPPING_DEVICE B, TBL_GAS G
		  WHERE A.mac_addr = B.mac_addr
		    AND B.gas_id = G.gas_id
		    AND B.company_id = #{company_id}
		  <if test="building_id != null and building_id != ''">
		    AND B.building_id = #{building_id}
		  </if>
		  <if test="zone_id != null and zone_id != ''">
		    AND B.zone_id = #{zone_id}
		  </if>
		  <if test="cell_id != null and cell_id != ''">
		    AND B.cell_id = #{cell_id}
		  </if>
		  ORDER BY A.reg_dt DESC
		  <if test="notUsePage == null or notUsePage == ''">
			LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
		</if>	
	</select>
	
	<select id="selectGasStatusListTotal" parameterType="SBeaconCollectVO" resultType="Integer">
		SELECT COUNT(*)
		  FROM (
				SELECT mac_addr, ap_mac_addr, CONCAT(oxygen_value, '.', oxygen_point_value) AS oxygen_value
					 , carbon_monoxide_value
					 , hydrogen_sulfide_value
					 , methan_value
					 , CONCAT(temperature_value, '.', temperature_point_value) AS temperature_value
					 , humidity
					 , reg_dt
				  FROM TBL_COLLECT_SBEACON
				 WHERE 1=1
				 <choose>
		            <when test="macAddressList.size != 0">
		                AND mac_addr in 
		                <foreach collection="macAddressList" item="item" index="index" separator="," open="(" close=")">
		                    #{item}
		                </foreach>
		            </when>
		        </choose>
		        <if test="start_date != null and start_date != ''">
		        	<![CDATA[
				    AND reg_dt >= STR_TO_DATE(CONCAT(#{start_date}, #{start_time}, ':00:00'),'%Y-%m-%d %H:%i:%s')
				    ]]>
				 </if>
				 <if test="end_date != null and end_date != ''">
		        	<![CDATA[
				    AND reg_dt <= STR_TO_DATE(CONCAT(#{end_date}, #{end_time}, ':59:59'),'%Y-%m-%d %H:%i:%s')
				    ]]>
				 </if>
		        ) A, TBL_MAPPING_DEVICE B, TBL_GAS G
		  WHERE A.mac_addr = B.mac_addr
		    AND B.gas_id = G.gas_id
		    AND B.company_id = #{company_id}
		  <if test="building_id != null and building_id != ''">
		    AND B.building_id = #{building_id}
		  </if>
		  <if test="zone_id != null and zone_id != ''">
		    AND B.zone_id = #{zone_id}
		  </if>
		  <if test="cell_id != null and cell_id != ''">
		    AND B.cell_id = #{cell_id}
		  </if>
	</select>
	
	<select id="selectGasStatusListByDeviceNo" parameterType="SBeaconCollectVO" resultType="SBeaconCollectVO">
		SELECT *
			 <if test="locale == 'en'">
			 , (SELECT BUILDING_NAME_ENG FROM TBL_BUILDING C WHERE B.BUILDING_ID = C.BUILDING_ID AND C.COMPANY_ID = #{company_id} LIMIT 1) AS BUILDING_NAME
			 , (SELECT FLOOR_ENG FROM TBL_ZONE D WHERE B.ZONE_ID = D.ZONE_ID AND D.COMPANY_ID = #{company_id} LIMIT 1) AS ZONE_NAME
			 , (SELECT CELL_NAME_ENG FROM TBL_CELL E WHERE B.CELL_ID = E.CELL_ID AND E.COMPANY_ID = #{company_id} LIMIT 1) AS CELL_NAME
			 </if>
			 <if test="locale != 'en'">
			 , (SELECT BUILDING_NAME FROM TBL_BUILDING C WHERE B.BUILDING_ID = C.BUILDING_ID AND C.COMPANY_ID = #{company_id} LIMIT 1) AS BUILDING_NAME
			 , (SELECT FLOOR FROM TBL_ZONE D WHERE B.ZONE_ID = D.ZONE_ID AND D.COMPANY_ID = #{company_id} LIMIT 1) AS ZONE_NAME
			 , (SELECT CELL_NAME FROM TBL_CELL E WHERE B.CELL_ID = E.CELL_ID AND E.COMPANY_ID = #{company_id} LIMIT 1) AS CELL_NAME
			 </if>
		 
		  FROM (
		  		SELECT B.mac_addr
		  			 , B.ap_mac_addr
		  			 , CONCAT(B.oxygen_value, '.', B.oxygen_point_value) AS oxygen_value
					 , B.carbon_monoxide_value
					 , B.hydrogen_sulfide_value
					 , B.methan_value
					 , CONCAT(B.temperature_value, '.', B.temperature_point_value) AS temperature_value
					 , B.humidity
					 , B.reg_dt
		  		  FROM (
						SELECT mac_addr
		 					 , MAX(collect_sensor_beacon_id) AS collect_sensor_beacon_id
		  				  FROM TBL_COLLECT_SBEACON
		 				 WHERE 1=1
		 				 <choose>
				            <when test="macAddressList.size != 0">
				                and mac_addr in 
				                <foreach collection="macAddressList" item="item" index="index" separator="," open="(" close=")">
				                    #{item}
				                </foreach>
				            </when>
				        </choose>
		 				 GROUP BY mac_addr
						) A , TBL_COLLECT_SBEACON B
						WHERE A.mac_addr = B.mac_addr
						  AND A.collect_sensor_beacon_id = B.collect_sensor_beacon_id
		        ) SB, TBL_MAPPING_DEVICE B, TBL_GAS G
		  WHERE SB.mac_addr = B.mac_addr
		    AND B.gas_id = G.gas_id
		    AND B.company_id = #{company_id}
		  <if test="building_id != null and building_id != ''">
		    AND B.building_id = #{building_id}
		  </if>
		  <if test="zone_id != null and zone_id != ''">
		    AND B.zone_id = #{zone_id}
		  </if>
		  <if test="cell_id != null and cell_id != ''">
		    AND B.cell_id = #{cell_id}
		  </if>
		  ORDER BY SB.reg_dt DESC, B.device_no ASC
		  <if test="notUsePage == null or notUsePage == ''">
			LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
		</if>
	</select>
	
	<select id="selectGasStatusListTotalByDeviceNo" parameterType="SBeaconCollectVO" resultType="Integer">
		SELECT COUNT(*)
		  FROM (
		  		SELECT B.* 
		  		  FROM (
						SELECT mac_addr
		 					 , MAX(collect_sensor_beacon_id) AS collect_sensor_beacon_id
		  				  FROM TBL_COLLECT_SBEACON
		 				 WHERE 1=1
		 				 <choose>
				            <when test="macAddressList.size != 0">
				                and mac_addr in 
				                <foreach collection="macAddressList" item="item" index="index" separator="," open="(" close=")">
				                    #{item}
				                </foreach>
				            </when>
				        </choose>
		 				 GROUP BY mac_addr
						) A , TBL_COLLECT_SBEACON B
						WHERE A.mac_addr = B.mac_addr
						  AND A.collect_sensor_beacon_id = B.collect_sensor_beacon_id
		        ) SB, TBL_MAPPING_DEVICE B, TBL_GAS G
		  WHERE SB.mac_addr = B.mac_addr
		    AND B.gas_id = G.gas_id
		    AND B.company_id = #{company_id}
		  <if test="building_id != null and building_id != ''">
		    AND B.building_id = #{building_id}
		  </if>
		  <if test="zone_id != null and zone_id != ''">
		    AND B.zone_id = #{zone_id}
		  </if>
		  <if test="cell_id != null and cell_id != ''">
		    AND B.cell_id = #{cell_id}
		  </if>
	</select>
	
	<select id="selectGasStatusPerMacAddr" parameterType="SBeaconCollectVO" resultType="SBeaconCollectVO">
		SELECT A.mac_addr, A.ap_mac_addr, CONCAT(A.oxygen_value, '.', A.oxygen_point_value) AS oxygen_value
			 , A.carbon_monoxide_value
			 , A.hydrogen_sulfide_value
			 , A.methan_value
			 , CONCAT(A.temperature_value, '.', A.temperature_point_value) AS temperature_value
			 , A.humidity
			 , A.reg_dt
			 , B.device_no
			 , B.product_name
			 , B.building_id
			 <if test="locale == 'en'">
			 , (SELECT BUILDING_NAME_ENG FROM TBL_BUILDING C WHERE B.BUILDING_ID = C.BUILDING_ID AND C.COMPANY_ID = #{company_id} LIMIT 1) AS BUILDING_NAME
			 , (SELECT FLOOR_ENG FROM TBL_ZONE D WHERE B.ZONE_ID = D.ZONE_ID AND D.COMPANY_ID = #{company_id} LIMIT 1) AS ZONE_NAME
			 , (SELECT CELL_NAME_ENG FROM TBL_CELL E WHERE B.CELL_ID = E.CELL_ID AND E.COMPANY_ID = #{company_id} LIMIT 1) AS CELL_NAME
			 </if>
			 <if test="locale != 'en'">
			 , (SELECT BUILDING_NAME FROM TBL_BUILDING C WHERE B.BUILDING_ID = C.BUILDING_ID AND C.COMPANY_ID = #{company_id} LIMIT 1) AS BUILDING_NAME
			 , (SELECT FLOOR FROM TBL_ZONE D WHERE B.ZONE_ID = D.ZONE_ID AND D.COMPANY_ID = #{company_id} LIMIT 1) AS ZONE_NAME
			 , (SELECT CELL_NAME FROM TBL_CELL E WHERE B.CELL_ID = E.CELL_ID AND E.COMPANY_ID = #{company_id} LIMIT 1) AS CELL_NAME
			 </if>

			 , (SELECT POI_ID FROM TBL_CELL E WHERE B.CELL_ID = E.CELL_ID AND E.COMPANY_ID = #{company_id} LIMIT 1) AS POI_ID
		  FROM TBL_COLLECT_SBEACON_REAL A, TBL_MAPPING_DEVICE B, TBL_GAS G
		  	WHERE A.mac_addr = B.mac_addr
		    AND B.gas_id = G.gas_id
		    AND B.company_id = #{company_id}
		  <if test="building_id != null and building_id != ''">
		    AND B.building_id = #{building_id}
		  </if>
		  <if test="zone_id != null and zone_id != ''">
		    AND B.zone_id = #{zone_id}
		  </if>
		  <if test="cell_id != null and cell_id != ''">
		    AND B.cell_id = #{cell_id}
		  </if>
		  ORDER BY A.reg_dt DESC
	</select>
	
	
	<delete id="deleteMappingDevice" parameterType="DeviceVO">
		DELETE FROM TBL_MAPPING_DEVICE WHERE mapping_device_id = #{mapping_device_id}
	</delete>
	
	<select id="selectMappingDeviceDetail" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT *
			 <if test="locale == 'en'">
			 , (SELECT BUILDING_NAME_ENG FROM TBL_BUILDING C WHERE B.BUILDING_ID = C.BUILDING_ID AND C.COMPANY_ID = #{company_id} LIMIT 1) AS BUILDING_NAME
			 , (SELECT FLOOR_ENG FROM TBL_ZONE D WHERE B.ZONE_ID = D.ZONE_ID AND D.COMPANY_ID = #{company_id} LIMIT 1) AS floor
			 , (SELECT CELL_NAME_ENG FROM TBL_CELL E WHERE B.CELL_ID = E.CELL_ID AND E.COMPANY_ID = #{company_id} LIMIT 1) AS CELL_NAME
			 </if>
			 <if test="locale != 'en'">
			 , (SELECT BUILDING_NAME FROM TBL_BUILDING C WHERE B.BUILDING_ID = C.BUILDING_ID AND C.COMPANY_ID = #{company_id} LIMIT 1) AS BUILDING_NAME
			 , (SELECT FLOOR FROM TBL_ZONE D WHERE B.ZONE_ID = D.ZONE_ID AND D.COMPANY_ID = #{company_id} LIMIT 1) AS floor
			 , (SELECT CELL_NAME FROM TBL_CELL E WHERE B.CELL_ID = E.CELL_ID AND E.COMPANY_ID = #{company_id} LIMIT 1) AS CELL_NAME
			 </if>
			 , (SELECT POI_ID FROM TBL_CELL E WHERE B.CELL_ID = E.CELL_ID AND E.COMPANY_ID = #{company_id} LIMIT 1) AS POI_ID
			 , (SELECT worker_name FROM TBL_WORKER F WHERE B.WORKER_ID = F.WORKER_ID AND F.COMPANY_ID = #{company_id} LIMIT 1) AS WORKER_NAME
			 , (SELECT worker_name FROM TBL_WORKER F WHERE B.WORKER_ID2 = F.WORKER_ID AND F.COMPANY_ID = #{company_id} LIMIT 1) AS WORKER_NAME2
		  FROM TBL_MAPPING_DEVICE B
		 WHERE 1=1
		  <if test="mapping_device_id != null and mapping_device_id != ''">
		    AND B.mapping_device_id = #{mapping_device_id}
		  </if>
		  <if test="device_no != null and device_no != ''">
		    AND B.device_no = #{device_no}
		  </if>
		  <if test="device_type != null and device_type != ''">
		    AND B.device_type = #{device_type}
		  </if>
		  <if test="retain_type != null and retain_type != ''">
		    AND B.retain_type = #{retain_type}
		  </if>
		  <if test="company_id != null and company_id != ''">
		    AND B.company_id = #{company_id}
		  </if>
		  <if test="cell_id != null and cell_id != ''">
		    AND B.cell_id = #{cell_id}
		  </if>
	</select>
	
	<select id="selectDeviceProduct" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT *
		  FROM TBL_DEVICE_PRODUCT
		 WHERE 1=1
		   <if test="product_name != null and product_name != ''">
		   AND product_name = #{product_name}
		   </if>
		   <if test="device_code != null and device_code != ''">
		   AND device_code = #{device_code}
		   </if>
		   AND company_id = #{company_id}
		 LIMIT 1
	</select>
	
	<select id="selectApList" parameterType="DeviceVO" resultType="DeviceVO">
		select B.mac_addr
			 , A.cell_id
			 , A.poi_id
			 , A.building_id
			 , A.zone_id
			 , B.device_type
			 , B.device_no
			 , B.worker_id
			 , B.worker_id2
			 , B.product_name
			 , (SELECT building_name FROM TBL_BUILDING C WHERE A.building_id = C.building_id AND C.company_id = #{company_id} LIMIT 1) AS building_name
			 , (SELECT floor FROM TBL_ZONE C WHERE A.zone_id = C.zone_id AND C.company_id = #{company_id} LIMIT 1) AS floor
			 , (SELECT scene_id FROM TBL_ZONE C WHERE A.zone_id = C.zone_id AND C.company_id = #{company_id} LIMIT 1) AS scene_id
			 , (SELECT cell_name FROM TBL_CELL C WHERE A.cell_id = C.cell_id AND C.company_id = #{company_id} LIMIT 1) AS cell_name
			 , (SELECT building_name_eng FROM TBL_BUILDING C WHERE A.building_id = C.building_id AND C.company_id = #{company_id} LIMIT 1) AS building_name_eng
			 , (SELECT floor_eng FROM TBL_ZONE C WHERE A.zone_id = C.zone_id AND C.company_id = #{company_id} LIMIT 1) AS floor_eng
			 , (SELECT cell_name_eng FROM TBL_CELL C WHERE A.cell_id = C.cell_id AND C.company_id = #{company_id} LIMIT 1) AS cell_name_eng
			 , (SELECT worker_name FROM TBL_WORKER C WHERE C.worker_id = B.worker_id AND C.COMPANY_ID = #{company_id} LIMIT 1) AS worker_name
			 , (SELECT worker_name FROM TBL_WORKER C WHERE C.worker_id = B.worker_id2 AND C.COMPANY_ID = #{company_id} LIMIT 1) AS worker_name2
		  from TBL_CELL A, TBL_MAPPING_DEVICE B
		 WHERE A.CELL_ID = B.CELL_ID
		   AND A.COMPANY_ID = #{company_id}
		   AND B.COMPANY_ID = #{company_id}
		   <if test="building_id != null and building_id != ''">
		   AND A.BUILDING_ID = #{building_id}
		   </if>
		   <if test="zone_id != null and zone_id != ''">
		   AND A.ZONE_ID = #{zone_id}
		   </if>
		   <if test="cell_id != null and cell_id != ''">
		   AND A.CELL_ID = #{cell_id}
		   </if>
		   AND B.DEVICE_TYPE = #{device_type}
	</select>
	
	<select id="selectAnemometerList" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT *
		  FROM TBL_DEVICE_ANEMOMETER A, TBL_MAPPING_DEVICE B
		 WHERE A.company_id = #{company_id}
		   AND A.mac_addr = B.mac_addr
		   AND A.device_type = B.device_type
	</select>
	
	<select id="selectCraneSettingList" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT B.*
		  FROM TBL_DEVICE_CRANE A, TBL_MAPPING_DEVICE B
		 WHERE A.company_id = #{company_id}
		   AND A.mac_addr = B.mac_addr
		   AND A.device_type = B.device_type
	</select>
	
	<update id="updateAnemometer" parameterType="DeviceVO">
		UPDATE TBL_MAPPING_DEVICE
		   SET wind_warning_threshold = #{wind_warning_threshold}
		   	 , wind_danger_threshold = #{wind_danger_threshold}
		 WHERE device_no = #{device_no}
		   AND company_id = #{company_id}
		   AND device_type = #{device_type}
	</update>
	
	<update id="updateAnemometer2" parameterType="DeviceVO">
		UPDATE TBL_MAPPING_DEVICE
		   SET fever_threshold = #{fever_threshold}
		 WHERE device_no = #{device_no}
		   AND company_id = #{company_id}
		   AND device_type = #{device_type}
	</update>
	
	<update id="updateCraneSetting" parameterType="DeviceVO">
		UPDATE TBL_MAPPING_DEVICE
		   SET warning_distance = #{warning_distance}
		   	 , danger_distance = #{danger_distance}
		   	 , jib_length = #{jib_length}
		   	 , counter_jib_length = #{counter_jib_length}
		   	 , trolly_warning_distance = #{trolly_warning_distance}
		   	 , trolly_danger_distance = #{trolly_danger_distance}
		 WHERE device_no = #{device_no}
		   AND company_id = #{company_id}
		   AND device_type = #{device_type}
	</update>
	
	<insert id="insertAnemometer" parameterType="DeviceVO">
		INSERT INTO TBL_COLLECT_ANEMOMETER ( 
				device_anemometer_id,
				wind_speed_current,
				wind_speed_average,
				reg_dt
			)
			VALUES
			(
				'1',
				#{wind_speed_current},
				#{wind_speed_average},
				#{reg_dt}
			 )
	</insert>
	
	<select id="selectCollectAnemometer" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT DATE_ADD(reg_dt, INTERVAL 1 MINUTE) AS reg_dt
		  FROM TBL_COLLECT_ANEMOMETER
		 WHERE collect_anemometer_id = (SELECT MAX(collect_anemometer_id) from TBL_COLLECT_ANEMOMETER)
	</select>
	
	<select id="selectAnemometer" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT wind_speed_current, wind_speed_average, DATE_FORMAT(A.reg_dt,'%Y-%m-%d %H:%i') AS reg_dt
		   FROM TBL_COLLECT_ANEMOMETER A
		  WHERE A.reg_dt in (
							SELECT ANO.reg_dt
							  FROM (
									 SELECT MAX(reg_dt) AS reg_dt, DATE_FORMAT(reg_dt,'%Y-%m-%d %H:%i') AS time
											  FROM TBL_COLLECT_ANEMOMETER
											 WHERE 1=1
											   AND reg_dt BETWEEN STR_TO_DATE(CONCAT(#{start_date}, ' 00:00:00'),'%Y-%m-%d %H:%i:%s') AND STR_TO_DATE(CONCAT(#{start_date}, '23:59:59'),'%Y-%m-%d %H:%i:%s')
											   AND anemometer_id = #{mac_addr}
											 GROUP BY time
									 ) ANO
							)
		    AND A.anemometer_id = #{mac_addr}
	</select>
	
	<select id="selectAnemometerDetailList" parameterType="DeviceVO" resultType="DeviceVO">
		<![CDATA[
		SELECT *
		  FROM (
				SELECT A.wind_speed_current
					 , A.wind_speed_average
					 , A.reg_dt
					 , B.device_no
					 , B.wind_warning_threshold
					 , B.wind_danger_threshold
					 , DATE_ADD(#{reg_dt}, INTERVAL -1 HOUR) AS start_date
					 , DATE_ADD(#{reg_dt}, INTERVAL 1 HOUR) AS end_date
					 , (SELECT building_name FROM TBL_BUILDING D WHERE D.building_id = B.building_id AND D.company_id = #{company_id} LIMIT 1) AS building_name
					 , (SELECT floor FROM TBL_ZONE E WHERE E.zone_id = B.zone_id AND E.company_id = #{company_id} LIMIT 1) AS floor
					 , (SELECT cell_name FROM TBL_CELL F WHERE F.cell_id = B.cell_id AND F.company_id = #{company_id} LIMIT 1) AS cell_name
					 , CASE WHEN A.wind_speed_current >= B.wind_danger_threshold THEN 2
					 		WHEN A.wind_speed_current >= B.wind_warning_threshold THEN 1
					 		ELSE 0 END AS status
					 , CASE WHEN A.wind_speed_average >= B.wind_danger_threshold THEN 2
					 		WHEN A.wind_speed_average >= B.wind_warning_threshold THEN 1
					 		ELSE 0 END AS status2
					 , A.threshold
				  FROM (
				  		SELECT anemometer_id, wind_speed_current, wind_speed_average, reg_dt, threshold
						   FROM TBL_COLLECT_ANEMOMETER
						  WHERE 1=1
						    AND reg_dt BETWEEN STR_TO_DATE(DATE_ADD(#{reg_dt}, INTERVAL -1 HOUR),'%Y-%m-%d %H:%i:%s') AND STR_TO_DATE(DATE_ADD(#{reg_dt}, INTERVAL 1 HOUR),'%Y-%m-%d %H:%i:%s')
						    AND anemometer_id = #{mac_addr}
						) A, TBL_MAPPING_DEVICE B
				 WHERE 1=1
				   AND A.anemometer_id = B.mac_addr
				   AND B.mac_addr = #{mac_addr}
				   AND B.device_type = #{device_type}
				 ) WIND
		]]>
		WHERE 1=1
		<if test="status != null and status != ''">
		  AND WIND.status = #{status}
		</if>
		<if test="notUsePage != null and notUsePage != ''">
		  ORDER BY WIND.reg_dt DESC
		</if>
	</select>
	
	<select id="selectLastAnemometer" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT *
		  FROM TBL_COLLECT_ANEMOMETER_REAL A, TBL_MAPPING_DEVICE B
		 WHERE A.anemometer_id = B.mac_addr
		   AND B.device_type = #{device_type}
		   AND B.mac_addr = #{mac_addr}
		   AND B.company_id = #{company_id}
	</select>
	
	<select id="selectCheckAnemometer" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT A.wind_speed_current
			 , A.wind_speed_average
			 , A.reg_dt
			 , threshold
			 , B.device_no
		  FROM TBL_COLLECT_ANEMOMETER_REAL A, TBL_MAPPING_DEVICE B
		 WHERE A.anemometer_id = B.mac_addr
		   AND B.device_type = #{device_type}
		   AND B.mac_addr = #{mac_addr}
		   AND B.company_id = #{company_id}
		 ORDER BY A.reg_dt
	</select>
	
	<select id="selectCraneList" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT *
		  FROM TBL_DEVICE_CRANE
		 WHERE company_id = #{company_id}
	</select>
	
	<select id="selectCraneByPoiId" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT A.*
			 , B.warning_distance
			 , B.danger_distance
			 , B.device_no
			 , B.crane_type
			 , (SELECT event_type FROM TBL_EVENT C WHERE C.company_id=#{company_id} AND C.menu_type ='MENU_TC' AND C.status='0' AND C.mac_addr = B.mac_addr ORDER BY event_id DESC LIMIT 1) as event_type
		  FROM TBL_COLLECT_CRANE_REAL A, TBL_MAPPING_DEVICE B
		 WHERE A.crane_id = (
							SELECT mac_addr
							  FROM TBL_MAPPING_DEVICE
							 WHERE cell_id = (
												SELECT cell_id
												  FROM TBL_CELL
												 WHERE company_id = #{company_id}
												   AND poi_id = #{poi_id}
												 LIMIT 1
											 )
							   AND device_type = #{device_type}
							   AND company_id = #{company_id}
							 LIMIT 1
						 )
		  AND A.crane_id = B.mac_addr
	</select>
	
	<select id="selectCraneDetail" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT * FROM TBL_MAPPING_DEVICE
		 WHERE 1=1
		   AND company_id = #{company_id}
		   AND device_type = #{device_type}
			AND mac_addr = #{mac_addr}
	</select>
		
	<select id="selectTagListForApi" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT A.*, B.*, C.*, D.equip_id, D.equip_name FROM TBL_DEVICE_TAG A
		  
		  LEFT JOIN TBL_MAPPING_TAG B ON B.device_no = A.device_no
		  LEFT JOIN TBL_WORKER C ON C.worker_id = B.worker_id
		  LEFT JOIN TBL_EQUIP D ON D.equip_id = C.equip_id
		  
		 WHERE 1=1
		   <if test="company_id != null and company_id != ''">
		   		AND A.company_id = #{company_id}
		   </if>
		   <if test="mac_addr != null and mac_addr != ''">
		   		AND A.mac_addr = #{mac_addr}
		   </if>
		  	<if test="device_id != null and device_id != ''">
		   		AND A.device_id = #{device_id}
		   </if>
		  	<if test="device_no != null and device_no != ''">
		   		AND A.device_no = #{device_no}
		   </if>		   
	</select>
	
	<select id="selectOriginCraneList" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT *
		  FROM TBL_DEVICE_CRANE_SPEC
		 ORDER BY device_id
	</select>
	
	<select id="selectOriginCraneDetail" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT *
		  FROM TBL_DEVICE_CRANE_SPEC
		 WHERE device_id = #{mac_addr}
	</select>
	
	<select id="selectOriginAnemometerDetail" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT *
		  FROM TBL_DEVICE_ANEMOMETER_SPEC
		 WHERE device_id = #{mac_addr}
	</select>
	
	<select id="selectOriginAnemometerList" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT *
		  FROM TBL_DEVICE_ANEMOMETER_SPEC
		 ORDER BY device_id
	</select>
	
	<select id="selectOriginRetainList" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT *
		  FROM TBL_DEVICE_RETAIN_SPEC
		 WHERE 1=1
		<if test="retain_type != null and retain_type != ''">
		   AND retain_type = #{retain_type}
		</if>		  
		 ORDER BY device_id
	</select>
	
	<select id="selectRetainByPoiId" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT A.retain_type
			 , MAX(A.reg_dt) AS reg_dt
			 , A.device_no
			 , MAX(B.measure_dt) AS measure_dt
			<if test="locale == 'en'">
			 , (SELECT building_name_eng FROM TBL_BUILDING D WHERE D.building_id = A.building_id AND D.company_id = #{company_id} LIMIT 1) AS building_name
			 , (SELECT floor_eng FROM TBL_ZONE E WHERE E.zone_id = A.zone_id AND E.company_id = #{company_id} LIMIT 1) AS floor
			 , (SELECT cell_name_eng FROM TBL_CELL F WHERE F.cell_id = A.cell_id AND F.company_id = #{company_id} LIMIT 1) AS cell_name
			</if>
			<if test="locale != 'en'">
			 , (SELECT building_name FROM TBL_BUILDING D WHERE D.building_id = A.building_id AND D.company_id = #{company_id} LIMIT 1) AS building_name
			 , (SELECT floor FROM TBL_ZONE E WHERE E.zone_id = A.zone_id AND E.company_id = #{company_id} LIMIT 1) AS floor
			 , (SELECT cell_name FROM TBL_CELL F WHERE F.cell_id = A.cell_id AND F.company_id = #{company_id} LIMIT 1) AS cell_name
			</if>
			 
		  FROM TBL_MAPPING_DEVICE A LEFT OUTER JOIN (
		  							SELECT * 
		  							  FROM TBL_COLLECT_RETAIN 
		  							 WHERE 1=1
		  							   AND (max_variation_measure IS NOT NULL OR measure_value IS NOT NULL)
		  						) B ON A.mac_addr = B.retain_id AND A.retain_type = B.retain_type
		 WHERE A.cell_id in (
							SELECT cell_id
							  FROM TBL_CELL
							 WHERE company_id = #{company_id}
							   AND poi_id = #{poi_id}
						 )
		   AND A.device_type = #{device_type}
		   AND A.company_id = #{company_id}
		GROUP BY A.retain_type, A.device_no
		ORDER BY reg_dt DESC
		<if test="notUsePage == null or notUsePage == ''">
			LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
		</if>
	</select>
	
	<select id="selectRetainByPoiIdTotal" parameterType="DeviceVO" resultType="Integer">
	SELECT COUNT(*)
	  FROM (
			SELECT A.retain_type
			 , MAX(A.reg_dt) AS reg_dt
			 , A.device_no
			 , MAX(B.measure_dt) AS measure_dt
			 , (SELECT building_name FROM TBL_BUILDING D WHERE D.building_id = A.building_id AND D.company_id = #{company_id} LIMIT 1) AS building_name
			 , (SELECT floor FROM TBL_ZONE E WHERE E.zone_id = A.zone_id AND E.company_id = #{company_id} LIMIT 1) AS floor
			 , (SELECT cell_name FROM TBL_CELL F WHERE F.cell_id = A.cell_id AND F.company_id = #{company_id} LIMIT 1) AS cell_name
		  FROM TBL_MAPPING_DEVICE A LEFT OUTER JOIN (
		  							SELECT * 
		  							  FROM TBL_COLLECT_RETAIN 
		  							 WHERE 1=1
		  							   AND (max_variation_measure IS NOT NULL OR measure_value IS NOT NULL)
		  						) B ON A.mac_addr = B.retain_id AND A.retain_type = B.retain_type
		 WHERE A.cell_id in (
							SELECT cell_id
							  FROM TBL_CELL
							 WHERE company_id = #{company_id}
							   AND poi_id = #{poi_id}
						 )
		   AND A.device_type = #{device_type}
		   AND A.company_id = #{company_id}
		GROUP BY A.retain_type, A.device_no
			) RETAIN
	</select>
	
	<select id="selectCollectCrane" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT *
		  FROM TBL_COLLECT_CRANE_REAL
		 WHERE crane_id = #{mac_addr}
	</select>
	
	<select id="selectDeviceTypeList" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT  device_type_id
		       ,device_code
			   ,device_name_eng
			   ,menu_type
			   ,reg_dt
			   ,reg_id
			   ,mod_dt
			   ,mod_id
			<if test="locale == 'en'">
			   ,device_name_eng AS device_name  <!--  SELECT 파라미터 설정이 뒤에서 부터이므로, Rewrite됨. -->
			</if>
			   ,device_name  
			
		  FROM TBL_DEVICE_TYPE
		WHERE 1=1
		   <if test="menu_type != null and menu_type != ''">
		   AND menu_type = #{menu_type}
		   </if>
		 ORDER BY device_code ASC
	</select>
	
	<insert id="insertDeviceHistory" parameterType="DeviceVO">
		INSERT INTO TBL_DEVICE_HISTORY (
				company_id,
				device_type,
				device_no,
				mac_addr,
				device_history_type,
				<if test="building_id != null and building_id != ''">
				building_id,
				</if>
				<if test="zone_id != null and zone_id != ''">
				zone_id,
				</if>
				<if test="cell_id != null and cell_id != ''">
				cell_id,
				</if>
				<if test="worker_id != null and worker_id != ''">
				worker_id,
				</if>
				reg_dt,
				reg_id
			)
			VALUES
			(
				#{company_id},
				#{device_type},
				#{device_no},
				#{mac_addr},
				#{device_history_type},
				<if test="building_id != null and building_id != ''">
				#{building_id},
				</if>
				<if test="zone_id != null and zone_id != ''">
				#{zone_id},
				</if>
				<if test="cell_id != null and cell_id != ''">
				#{cell_id},
				</if>
				<if test="worker_id != null and worker_id != ''">
				#{worker_id},
				</if>
				NOW(),
				#{reg_id}
			 )
		 on duplicate key 
		update device_history_type = #{device_history_type}
			 , building_id = #{building_id}
			 , device_no = #{device_no}
			 , mac_addr = #{mac_addr}
			 , zone_id = #{zone_id}
			 , cell_id = #{cell_id}
			 , reg_dt = NOW()
			 , reg_id = #{reg_id}
	</insert>
	
	<select id="selectDeviceHistoryList" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT A.*
			 , B.SITE_NAME
		  FROM TBL_DEVICE_HISTORY A, TBL_SITE B
		 WHERE A.COMPANY_ID = B.COMPANY_ID
		   AND A.mac_addr = #{mac_addr}
		   AND A.device_type = #{device_type}
		ORDER BY reg_dt DESC
		LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
	</select>
	
	<select id="selectDeviceHistoryListTotal" parameterType="DeviceVO" resultType="Integer">
		SELECT COUNT(*)
		  FROM TBL_DEVICE_HISTORY A, TBL_SITE B
		 WHERE A.COMPANY_ID = B.COMPANY_ID
		   AND A.mac_addr = #{mac_addr}
		   AND A.device_type = #{device_type}
	</select>
	
	<update id="updateMappingStrictureAp" parameterType="DeviceVO">
		UPDATE TBL_MAPPING_DEVICE
		   SET worker_id = #{worker_id}
		   	 , worker_id2 = #{worker_id2}
		   	 , worker_radious = #{worker_radious}
		 WHERE device_no = #{device_no}
		   AND company_id = #{company_id}
		   AND device_type = #{device_type}
	</update>
	
	<update id="updateMappingDevice" parameterType="DeviceVO">
		UPDATE TBL_MAPPING_DEVICE
		   SET mod_id = #{mod_id}
		   <if test="worker_id != null and worker_id != ''">
		   	 , worker_id = #{worker_id}
		   </if>
		   <if test="worker_id2 != null and worker_id2 != ''">
		   	 , worker_id2 = #{worker_id2}
		   </if>
		   <if test="worker_radious != null and worker_radious != ''">
		   	 , worker_radious = #{worker_radious}
		   </if>
		   <if test="setting_value != null and setting_value != ''">
		   	 , setting_value = #{setting_value}
		   </if>
		   <if test="manage_value != null and manage_value != ''">
		   	 , manage_value = #{manage_value}
		   </if>
		   <if test="check_out_type != null and check_out_type != ''">
		   	 , check_out_type = #{check_out_type}
		   </if>
		   <if test="gas_id != null and gas_id != ''">
		   	 , gas_id = #{gas_id}
		   </if>
		   <if test="wind_warning_threshold != null and wind_warning_threshold != ''">
		   	 , wind_warning_threshold = #{wind_warning_threshold}
		   </if>
		   <if test="wind_danger_threshold != null and wind_danger_threshold != ''">
		   	 , wind_danger_threshold = #{wind_danger_threshold}
		   </if>
		   <if test="wind_danger_threshold != null and wind_danger_threshold != ''">
		   	 , wind_danger_threshold = #{wind_danger_threshold}
		   </if>
		   <if test="crane_type != null and crane_type != ''">
		   	 , crane_type = #{crane_type}
		   </if>
		   <if test="jib_length != null and jib_length != ''">
		   	 , jib_length = #{jib_length}
		   </if>
		   <if test="counter_jib_length != null and counter_jib_length != ''">
		   	 , counter_jib_length = #{counter_jib_length}
		   </if>
		   <if test="warning_distance != null and warning_distance != ''">
		   	 , warning_distance = #{warning_distance}
		   </if>
		   <if test="danger_distance != null and danger_distance != ''">
		   	 , danger_distance = #{danger_distance}
		   </if>
		   <if test="trolly_warning_distance != null and trolly_warning_distance != ''">
		   	 , trolly_warning_distance = #{trolly_warning_distance}
		   </if>
		   <if test="trolly_danger_distance != null and trolly_danger_distance != ''">
		   	 , trolly_danger_distance = #{trolly_danger_distance}
		   </if>
		   <if test="fever_threshold != null and fever_threshold != ''">
		   	 , fever_threshold = #{fever_threshold}
		   </if>
		   <if test="fever_file_id != null and fever_file_id != ''">
		   	 , fever_file_id = #{fever_file_id}
		   </if>
		 WHERE mapping_device_id = #{mapping_device_id}
		   AND company_id = #{company_id}
	</update>
	
	<update id="updateRetain" parameterType="DeviceVO">
		UPDATE TBL_MAPPING_DEVICE
		   SET setting_value = #{setting_value}
		   	 , manage_value = #{manage_value}
		 WHERE device_no = #{device_no}
		   AND company_id = #{company_id}
		   AND device_type = #{device_type}
	</update>
	
	<select id="selectRetainList" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT *
			 , (SELECT POI_ID FROM TBL_CELL B WHERE A.CELL_ID = B.CELL_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS POI_ID
		  FROM TBL_MAPPING_DEVICE A
		 WHERE 1=1
		   AND company_id = #{company_id}
		   AND device_type = #{device_type}
		   <if test="retain_type != null and retain_type != ''">
		   AND retain_type = #{retain_type}
		   </if>
		   <if test="building_id != null and building_id != ''">
		   AND A.BUILDING_ID = #{building_id}
		   </if>
		   <if test="zone_id != null and zone_id != ''">
		   AND A.ZONE_ID = #{zone_id}
		   </if>
		   <if test="cell_id != null and cell_id != ''">
		   AND A.CELL_ID = #{cell_id}
		   </if>
	</select>
	
	<select id="selectRetainCollectDateList" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT A.measure_dt
		  FROM (
				SELECT DATE_FORMAT(measure_dt,'%Y-%m-%d') AS measure_dt
				  FROM TBL_COLLECT_RETAIN
				 WHERE retain_id = #{mac_addr}
				   AND retain_type = #{retain_type}
				) A
		 GROUP BY A.measure_dt
		 ORDER BY A.measure_dt DESC
	</select>
	
	<insert id="insertCollectRetain" parameterType="DeviceVO">
		INSERT INTO TBL_COLLECT_RETAIN ( 
				retain_id,
				retain_type,
				measure_value,
				max_variation_depth,
				max_variation_measure,
				measure_dt,
				reg_dt,
				threshold
			)
			VALUES
			(
				#{mac_addr},
				#{retain_type},
				#{measure_value},
				#{max_variation_depth},
				#{max_variation_measure},
				#{start_date},
				NOW(),
				#{threshold}
			 )
	</insert>
	
	<select id="selectMacDeivce" parameterType="DeviceVO" resultType="Integer">
		SELECT COUNT(*)
		FROM ${table_name}
		WHERE company_id = #{company_id}
		AND mac_addr = #{mac_addr}
		AND device_use_yn = 'Y'
	</select>
	
	<select id="selectDeviceHistory" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT
			   A.device_type
			 , A.device_no
			 , A.mac_addr
			 , A.device_history_type
			 , CASE WHEN A.device_history_type = 'I' THEN '설치' ELSE '반납' END AS device_history_type_name
			 , A.reg_dt
			 , A.reg_id
			 , A.company_id
			 , A.building_id
			 , A.zone_id
			 , A.cell_id
			<if test="locale == 'en'">
			 , (SELECT BUILDING_NAME_ENG FROM TBL_BUILDING B WHERE A.building_id = B.BUILDING_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS building_name
			 , (SELECT FLOOR_ENG FROM TBL_ZONE B WHERE A.zone_id = B.ZONE_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS floor
			 , (SELECT CELL_NAME_ENG FROM TBL_CELL B WHERE A.cell_id = B.CELL_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS cell_name
			</if>
			<if test="locale != 'en'">
			 , (SELECT BUILDING_NAME FROM TBL_BUILDING B WHERE A.building_id = B.BUILDING_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS building_name
			 , (SELECT FLOOR FROM TBL_ZONE B WHERE A.zone_id = B.ZONE_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS floor
			 , (SELECT CELL_NAME FROM TBL_CELL B WHERE A.cell_id = B.CELL_ID AND B.COMPANY_ID = #{company_id} LIMIT 1) AS cell_name
			</if>
			 , ( SELECT worker_name FROM TBL_WORKER B WHERE A.worker_id = B.worker_id ) AS worker_name 
		FROM TBL_DEVICE_HISTORY A
		WHERE 1=1
		AND A.company_id = #{company_id} 
		AND A.mac_addr = #{mac_addr}
		ORDER BY A.reg_dt DESC , A.device_history_type ASC
	</select>
	
	<select id="selectDeviceMac" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT *
		  FROM ${table_name}
		 WHERE 1=1
		   AND mac_addr = #{mac_addr}
		   <if test="device_product_id != null and device_product_id != ''">
		   AND device_product_id = #{device_product_id}
		   </if>
	</select>
	
	<select id="selectRetainCount" parameterType="DeviceVO" resultType="DeviceVO">
		SELECT retain_type
			 , COUNT(retain_type)
		  FROM TBL_MAPPING_DEVICE
		 WHERE COMPANY_ID = #{company_id}
		   AND device_type = #{device_type}
		 GROUP BY retain_type
	</select>
	
	<select id="selectDeviceTypeCount" parameterType="DeviceVO" resultType="Integer">
		SELECT COUNT(*)
		FROM TBL_DEVICE_TYPE
		WHERE 1=1
	    AND device_code = #{device_code}
	</select>
	
</mapper>