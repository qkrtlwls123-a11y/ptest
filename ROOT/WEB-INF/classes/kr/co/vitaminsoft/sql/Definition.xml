<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Definition">
	<sql id="definition_list_where">
		<if test="s_category_code != null and s_category_code != '' ">
			AND A.CATEGORY_CODE = #{s_category_code}
		</if>
		<if test="s_definition_nm != null and s_definition_nm != '' ">
			AND A.DEFINITION_NM LIKE CONCAT('%', #{s_definition_nm}, '%')
		</if> 
		<if test="s_use_yn != null and s_use_yn != '' ">
			AND A.USE_YN = #{s_use_yn}
		</if>
	</sql>
	
	<!-- 전체정의조회 -->
	<select id="selectDefinitionList" parameterType="box" resultType="box">
		SELECT
			  A.id
			, A.definition_nm
			, A.category_code
			, A.definition_txt
			, A.cause1
			, A.cause2
			, A.use_yn
			, B.code_nm category_nm
			, A.reg_id
			, C.user_nm reg_nm
			, DATE_FORMAT(A.REG_DT, '%Y-%m-%d') as reg_dt
			, A.edit_id
			, DATE_FORMAT(A.EDIT_DT, '%Y-%m-%d') as edit_dt
		FROM
			SV_DEFINITION A LEFT OUTER JOIN SV_CODE B ON B.UP_CODE = 'DEFINITION_TYPE' AND A.category_code = B.code
			INNER JOIN SV_USER C ON A.REG_ID = C.ID
			WHERE 1=1
		<include refid="definition_list_where"/>
		ORDER BY A.ID DESC
		LIMIT ${numPerPage} OFFSET ${startRow}
	</select>

	<select id="selectDefinitionListCount" parameterType="box" resultType="Integer">
		SELECT
			 COUNT(*) AS TOTAL_CNT
		FROM
			SV_DEFINITION A
		WHERE 1=1
		<include refid="definition_list_where"/>
	</select>
	
	<!-- 코드상세뷰 -->
	<select id="getDefinitionView" parameterType="box" resultType="box">
		SELECT 
			A.id
			,A.definition_nm
			,A.category_code
			,A.definition_txt
			,A.cause1
			,A.cause2
			,A.use_yn
			,A.reg_id
			,DATE_FORMAT(A.REG_DT, '%Y-%m-%d') as reg_dt
			,A.edit_id
			,DATE_FORMAT(A.EDIT_DT, '%Y-%m-%d') as edit_dt
		FROM SV_DEFINITION A
		WHERE A.id = #{id} 
	</select>
	
	<!-- 정의관리 Insert -->
	<insert id="definitionInsert" parameterType="box">
	   INSERT INTO SV_DEFINITION (
		   definition_nm
		   , category_code
		   , definition_txt
		   <if test="cause1 != null and cause1 != '' ">
		   , cause1
		   </if>
		   <if test="cause2 != null and cause2 != '' ">
		   , cause2
		   </if>
		   , use_yn
		   , reg_id
		   , reg_dt
		   ,edit_id
		   ,edit_dt
	   )  VALUES (
	   trim(#{definition_nm})
	   , #{category_code}
	   , #{definition_txt}
	   <if test="cause1 != null and cause1 != '' ">
	   , #{cause1}
	   </if>
	   <if test="cause2 != null and cause2 != '' ">
	   , #{cause2}
	   </if>
	   , #{use_yn}
	   , #{mem_id}
	   , now()
	   , #{mem_id}
	   ,now()
	   )
	</insert>
	
	<!-- 정의관리 Update -->
	<update id="definitionUpdate" parameterType="box" >
	   UPDATE SV_DEFINITION set
		   DEFINITION_NM = trim(#{definition_nm})
		   ,CATEGORY_CODE = #{category_code} 
		   ,DEFINITION_TXT = #{definition_txt}
		   <if test="cause1 != null and cause1 != '' ">
		   ,CAUSE1 = #{cause1}
		   </if>
		   <if test="cause2 != null and cause2 != '' ">
		   ,CAUSE2 = #{cause2}
		   </if>
		   ,USE_YN = #{use_yn}
		   ,EDIT_ID = #{mem_id}
		   ,EDIT_DT = now()
	   WHERE id = #{id}
	</update>
	
	<!-- 정의관리 Delete -->
	<delete id="definitionDelete" parameterType="box">
	   DELETE FROM SV_DEFINITION
	   WHERE id = #{id}
	</delete>
	
</mapper>